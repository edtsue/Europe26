<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Alps to Tuscany ‚Äî Family Trip Hub</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèîÔ∏è</text></svg>">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Alps to Tuscany">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,400&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  darkMode: 'class',
  theme: {
    extend: {
      fontFamily: {
        heading: ['Outfit', 'sans-serif'],
        body: ['DM Sans', 'sans-serif'],
      },
      colors: {
        austria: { DEFAULT: '#0d9488', light: '#99f6e4', dark: '#134e4a' },
        transition: { DEFAULT: '#d97706', light: '#fde68a', dark: '#78350f' },
        italy: { DEFAULT: '#c2410c', light: '#fed7aa', dark: '#7c2d12' },
        departure: { DEFAULT: '#475569', light: '#cbd5e1', dark: '#1e293b' },
      }
    }
  }
}
</script>
<style>
  * { box-sizing: border-box; }
  html { scroll-behavior: smooth; font-display: swap; }
  @media (prefers-reduced-motion: reduce) {
    html { scroll-behavior: auto; }
    *, *::before, *::after { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; }
  }
  body { font-family: 'DM Sans', sans-serif; margin: 0; padding: 0; min-height: 100vh; -webkit-font-smoothing: antialiased; }
  h1, h2, h3, h4, h5, h6 { font-family: 'Outfit', sans-serif; }

  /* Phase gradients */
  .phase-austria { background: linear-gradient(135deg, #0d9488 0%, #059669 50%, #047857 100%); }
  .phase-transition { background: linear-gradient(135deg, #d97706 0%, #b45309 50%, #92400e 100%); }
  .phase-italy { background: linear-gradient(135deg, #c2410c 0%, #b91c1c 50%, #9a3412 100%); }
  .phase-departure { background: linear-gradient(135deg, #475569 0%, #334155 50%, #1e293b 100%); }

  .phase-austria-light { background: linear-gradient(135deg, #ccfbf1 0%, #a7f3d0 100%); }
  .phase-transition-light { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); }
  .phase-italy-light { background: linear-gradient(135deg, #ffedd5 0%, #fed7aa 100%); }
  .phase-departure-light { background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%); }

  /* Glassmorphism */
  .glass { background: rgba(255,255,255,0.75); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.3); }
  .dark .glass { background: rgba(30,41,59,0.8); border: 1px solid rgba(255,255,255,0.1); }

  /* Animations */
  @keyframes fadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes slideDown { from { opacity: 0; max-height: 0; } to { opacity: 1; max-height: 3000px; } }
  @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
  @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
  .anim-fade { animation: fadeIn 0.4s ease-out forwards; }
  .anim-slide { animation: slideDown 0.35s ease-out forwards; overflow: hidden; }
  .anim-float { animation: float 3s ease-in-out infinite; }
  .anim-pulse { animation: pulse 2s ease-in-out infinite; }

  /* Tab content */
  .tab-panel { display: none; }
  .tab-panel.active { display: block; }

  /* Chevron */
  .chevron { transition: transform 0.3s ease; }
  .chevron.open { transform: rotate(180deg); }

  /* Checkbox animation */
  .check-box { width: 22px; height: 22px; border: 2px solid #94a3b8; border-radius: 6px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s ease; flex-shrink: 0; }
  .check-box.checked { background: #059669; border-color: #059669; }
  .check-box.checked::after { content: '‚úì'; color: white; font-size: 14px; font-weight: 700; }

  /* Bottom tab bar */
  .bottom-bar { position: fixed; bottom: 0; left: 0; right: 0; z-index: 100; padding-bottom: env(safe-area-inset-bottom, 0px); }

  /* Day nav */
  .day-nav { overflow-x: auto; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
  .day-nav::-webkit-scrollbar { display: none; }

  /* Tap targets */
  .tap { min-height: 44px; min-width: 44px; }

  /* Progress bar */
  .progress-track { height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden; }
  .dark .progress-track { background: #334155; }
  .progress-fill { height: 100%; border-radius: 3px; transition: width 0.4s ease; }

  /* Family tip */
  .family-tip { background: linear-gradient(135deg, #fce7f3, #fdf2f8); border-left: 4px solid #ec4899; }
  .dark .family-tip { background: linear-gradient(135deg, #831843, #4a0e2e); border-left: 4px solid #f472b6; }

  /* ZTL banner */
  .ztl-banner { background: linear-gradient(135deg, #fef3c7, #fde68a); border-left: 4px solid #f59e0b; }
  .dark .ztl-banner { background: linear-gradient(135deg, #78350f, #451a03); border-left: 4px solid #fbbf24; }
  .ztl-danger { background: linear-gradient(135deg, #fee2e2, #fecaca); border-left: 4px solid #ef4444; }
  .dark .ztl-danger { background: linear-gradient(135deg, #7f1d1d, #450a0a); border-left: 4px solid #f87171; }

  /* Expense category colors */
  .cat-food { background: #fef3c7; color: #92400e; }
  .cat-hotel { background: #dbeafe; color: #1e40af; }
  .cat-gas { background: #d1fae5; color: #065f46; }
  .cat-tickets { background: #ede9fe; color: #5b21b6; }
  .cat-shopping { background: #fce7f3; color: #9d174d; }
  .cat-parking { background: #e0e7ff; color: #3730a3; }
  .cat-other { background: #f1f5f9; color: #475569; }
  .dark .cat-food { background: #78350f; color: #fde68a; }
  .dark .cat-hotel { background: #1e3a5f; color: #93c5fd; }
  .dark .cat-gas { background: #064e3b; color: #6ee7b7; }
  .dark .cat-tickets { background: #4c1d95; color: #c4b5fd; }
  .dark .cat-shopping { background: #831843; color: #f9a8d4; }
  .dark .cat-parking { background: #312e81; color: #a5b4fc; }
  .dark .cat-other { background: #334155; color: #94a3b8; }

  /* Alternative cities explorer */
  .alt-explorer { border: 2px dashed rgba(194,65,12,0.3); background: linear-gradient(135deg, rgba(255,237,213,0.4), rgba(254,215,170,0.2)); }
  .dark .alt-explorer { border-color: rgba(251,146,60,0.3); background: linear-gradient(135deg, rgba(124,45,18,0.3), rgba(154,52,18,0.15)); }
  .alt-city-card { border: 1px solid rgba(194,65,12,0.2); transition: all 0.3s ease; cursor: pointer; }
  .alt-city-card:hover { border-color: rgba(194,65,12,0.5); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
  .dark .alt-city-card { border-color: rgba(251,146,60,0.2); }
  .dark .alt-city-card:hover { border-color: rgba(251,146,60,0.5); }
  .alt-city-card.expanded { border-color: #c2410c; background: rgba(255,237,213,0.3); }
  .dark .alt-city-card.expanded { border-color: #fb923c; background: rgba(124,45,18,0.3); }
  .alt-badge { display: inline-flex; align-items: center; gap: 4px; padding: 2px 10px; border-radius: 999px; font-size: 0.7rem; font-weight: 600; background: linear-gradient(135deg, #c2410c, #9a3412); color: white; }

  /* Modal overlay */
  .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 200; display: flex; align-items: flex-end; justify-content: center; }
  .modal-content { width: 100%; max-width: 500px; max-height: 85vh; overflow-y: auto; border-radius: 16px 16px 0 0; padding: 24px; padding-bottom: calc(24px + env(safe-area-inset-bottom, 0px)); }

  /* Scrollbar styling */
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 2px; }

  /* Dark mode overrides */
  .dark body, .dark .bg-white { background-color: #0f172a; color: #e2e8f0; }
  .dark .bg-gray-50, .dark .bg-gray-100 { background-color: #1e293b; }
  .dark .text-gray-900, .dark .text-gray-800 { color: #f1f5f9; }
  .dark .text-gray-700, .dark .text-gray-600 { color: #cbd5e1; }
  .dark .text-gray-500 { color: #94a3b8; }
  .dark .border-gray-200 { border-color: #334155; }
  .dark input, .dark textarea, .dark select { background-color: #1e293b; color: #e2e8f0; border-color: #334155; }

  /* ===== DESKTOP RESPONSIVE (768px+) ===== */
  @media (min-width: 768px) {
    /* Let content fill the available grid column */
    .max-w-lg { max-width: 100% !important; }

    /* Hide bottom tab bar on desktop */
    .bottom-bar { display: none; }

    /* Show desktop sidebar nav */
    .desktop-nav { display: flex !important; }

    /* Remove mobile bottom padding */
    body { padding-bottom: 0 !important; }

    /* App layout: sidebar + content */
    #app { display: grid; grid-template-columns: 240px 1fr; grid-template-rows: auto 1fr; min-height: 100vh; }
    #appHeader { grid-column: 1 / -1; }

    /* Tab panels fill content area */
    .tab-panel.active { display: block; overflow-y: auto; max-height: calc(100vh - 64px); }

    /* Desktop nav in sidebar */
    .desktop-nav { position: sticky; top: 64px; height: calc(100vh - 64px); flex-direction: column; padding: 1.5rem 1rem; gap: 0.25rem; }

    /* On desktop, sticky day nav is inside a scrollable panel, so top:0 */
    .md-sticky-top { top: 0 !important; }

    /* Content padding */
    #tabContent .max-w-lg { padding-left: 2rem; padding-right: 2rem; }

    /* Modal: center on desktop instead of bottom sheet */
    .modal-overlay { align-items: center; }
    .modal-content { border-radius: 16px; max-width: 600px; }

    /* Larger tap targets not needed on desktop */
    .tap { min-height: unset; min-width: unset; }

    /* Wider day cards, 2-col destinations grid */
    .dest-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; }
    .hotel-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; }

    /* Header gets more room */
    #appHeader .max-w-lg { max-width: 100% !important; }

    /* AM/PM side by side */
    .day-ampm { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }

    /* Settings 2-col */
    .settings-2col { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }

    /* Larger fonts on desktop */
    h1.font-heading { font-size: 1.5rem; }
    .font-heading.text-2xl { font-size: 2rem; }

    /* Status badges spread out more */
    .day-badges { gap: 0.75rem; }
  }

  /* Extra wide screens */
  @media (min-width: 1200px) {
    #app { grid-template-columns: 280px 1fr; }
    #tabContent .max-w-lg { padding-left: 3rem; padding-right: 3rem; }

    /* 3-col destinations on wide screens */
    .dest-grid { grid-template-columns: repeat(3, 1fr); }
  }

  /* Ultra wide screens */
  @media (min-width: 1600px) {
    /* Cap content at a comfortable reading width */
    #tabContent .max-w-lg { max-width: 1200px !important; }
  }

  /* Keep nav bars at fixed size regardless of font scaling */
  .bottom-bar { font-size: 16px; }
  #appHeader { font-size: 16px; }
  .desktop-nav { font-size: 16px; }

  /* Desktop nav hidden by default (shown via media query) */
  .desktop-nav { display: none; }
</style>
</head>
<body class="bg-gray-50 text-gray-900 font-body min-h-screen pb-20">

<!-- App Container -->
<div id="app">

  <!-- Header -->
  <header id="appHeader" class="sticky top-0 z-50 glass">
    <div class="max-w-lg mx-auto px-4 py-3 flex items-center justify-between">
      <div>
        <h1 class="font-heading font-800 text-xl leading-tight">Alps to Tuscany</h1>
        <p class="text-xs text-gray-500 dark:text-gray-400 font-body">Family Trip Hub</p>
      </div>
      <div class="flex items-center gap-1">
        <button onclick="quickCloudPush()" id="cloudSyncBtn" class="tap flex items-center justify-center w-10 h-10 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition" aria-label="Sync to cloud" title="Push to cloud">
          <span id="cloudSyncIcon" class="text-lg">‚òÅÔ∏è</span>
        </button>
        <button onclick="cycleFontSize()" class="tap flex items-center justify-center w-10 h-10 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition" aria-label="Change font size" title="Font size">
          <span id="fontSizeIcon" class="font-heading font-700 text-sm">A</span>
        </button>
        <button id="darkToggleHeader" onclick="toggleDarkMode()" class="tap flex items-center justify-center w-10 h-10 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition" aria-label="Toggle dark mode">
          <span id="darkIconHeader" class="text-xl">üåô</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Desktop Sidebar Nav -->
  <nav class="desktop-nav glass border-r border-gray-200 dark:border-gray-700">
    <button onclick="switchTab('today')" class="desktop-tab-btn flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-heading font-600 transition hover:bg-gray-100 dark:hover:bg-gray-700 text-left w-full" data-tab="today">
      <span class="text-lg">üìÖ</span> Today
    </button>
    <button onclick="switchTab('days')" class="desktop-tab-btn flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-heading font-600 transition hover:bg-gray-100 dark:hover:bg-gray-700 text-left w-full" data-tab="days">
      <span class="text-lg">üó∫</span> All Days
    </button>
    <button onclick="switchTab('hotels')" class="desktop-tab-btn flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-heading font-600 transition hover:bg-gray-100 dark:hover:bg-gray-700 text-left w-full" data-tab="hotels">
      <span class="text-lg">üè®</span> Hotels
    </button>
    <button onclick="switchTab('packing')" class="desktop-tab-btn flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-heading font-600 transition hover:bg-gray-100 dark:hover:bg-gray-700 text-left w-full" data-tab="packing">
      <span class="text-lg">üß≥</span> Packing List
    </button>
    <button onclick="switchTab('notes')" class="desktop-tab-btn flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-heading font-600 transition hover:bg-gray-100 dark:hover:bg-gray-700 text-left w-full" data-tab="notes">
      <span class="text-lg">üìù</span> Notes & Lists
    </button>
    <button onclick="switchTab('settings')" class="desktop-tab-btn flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-heading font-600 transition hover:bg-gray-100 dark:hover:bg-gray-700 text-left w-full" data-tab="settings">
      <span class="text-lg">‚öôÔ∏è</span> Settings
    </button>
    <div class="flex-1"></div>
    <div class="text-xs text-gray-400 dark:text-gray-500 px-4 pb-2">Mar 23 ‚Äì Apr 2, 2026</div>
  </nav>

  <!-- Main Content Area -->
  <div id="tabContent">

    <!-- Tab: Today -->
    <div id="tab-today" class="tab-panel active">
      <div class="max-w-lg mx-auto px-4 py-4">
        <div id="todayContent"></div>
      </div>
    </div>

    <!-- Tab: All Days -->
    <div id="tab-days" class="tab-panel">
      <div class="max-w-lg mx-auto px-4 pt-2 pb-4">
        <!-- Day Nav -->
        <div class="day-nav flex gap-2 py-3 pb-4 sticky top-12 z-40 bg-gray-50 dark:bg-gray-900 md-sticky-top" id="dayNav"></div>
        <!-- Day Cards -->
        <div id="dayCards" class="flex flex-col gap-4 mt-1"></div>
      </div>
    </div>

    <!-- Tab: Hotels -->
    <div id="tab-hotels" class="tab-panel">
      <div class="max-w-lg mx-auto px-4 py-4" id="hotelsContent"></div>
    </div>

    <!-- Tab: Packing List -->
    <div id="tab-packing" class="tab-panel">
      <div class="max-w-lg mx-auto px-4 py-4" id="packingContent"></div>
    </div>

    <!-- Tab: Notes & Lists -->
    <div id="tab-notes" class="tab-panel">
      <div class="max-w-lg mx-auto px-4 py-4">
        <!-- Sub-nav pills -->
        <div class="flex gap-2 mb-4 overflow-x-auto">
          <button onclick="switchNotesTab('journal')" class="notes-pill tap px-4 py-2 rounded-full text-sm font-heading font-600 whitespace-nowrap transition" data-pill="journal">üìù Journal</button>
          <button onclick="switchNotesTab('checklists')" class="notes-pill tap px-4 py-2 rounded-full text-sm font-heading font-600 whitespace-nowrap transition" data-pill="checklists">‚úÖ Checklists</button>
          <button onclick="switchNotesTab('expenses')" class="notes-pill tap px-4 py-2 rounded-full text-sm font-heading font-600 whitespace-nowrap transition" data-pill="expenses">üí∞ Expenses</button>
        </div>
        <!-- Journal -->
        <div id="notes-journal" class="notes-section"></div>
        <!-- Checklists -->
        <div id="notes-checklists" class="notes-section hidden"></div>
        <!-- Expenses -->
        <div id="notes-expenses" class="notes-section hidden"></div>
      </div>
    </div>

    <!-- Tab: Settings -->
    <div id="tab-settings" class="tab-panel">
      <div class="max-w-lg mx-auto px-4 py-4" id="settingsContent"></div>
    </div>

  </div><!-- /tabContent -->

</div>

<!-- Bottom Tab Bar -->
<nav class="bottom-bar glass shadow-lg border-t border-gray-200 dark:border-gray-700">
  <div class="max-w-lg mx-auto flex justify-around items-center py-2">
    <button onclick="switchTab('today')" class="tab-btn tap flex flex-col items-center gap-0.5 px-3 py-1 rounded-lg transition" data-tab="today">
      <span class="text-xl">üìÖ</span>
      <span class="text-xs font-heading font-600">Today</span>
    </button>
    <button onclick="switchTab('days')" class="tab-btn tap flex flex-col items-center gap-0.5 px-3 py-1 rounded-lg transition" data-tab="days">
      <span class="text-xl">üó∫</span>
      <span class="text-xs font-heading font-600">Days</span>
    </button>
    <button onclick="switchTab('hotels')" class="tab-btn tap flex flex-col items-center gap-0.5 px-3 py-1 rounded-lg transition" data-tab="hotels">
      <span class="text-xl">üè®</span>
      <span class="text-xs font-heading font-600">Hotels</span>
    </button>
    <button onclick="switchTab('packing')" class="tab-btn tap flex flex-col items-center gap-0.5 px-3 py-1 rounded-lg transition" data-tab="packing">
      <span class="text-xl">üß≥</span>
      <span class="text-xs font-heading font-600">Pack</span>
    </button>
    <button onclick="switchTab('notes')" class="tab-btn tap flex flex-col items-center gap-0.5 px-3 py-1 rounded-lg transition" data-tab="notes">
      <span class="text-xl">üìù</span>
      <span class="text-xs font-heading font-600">Notes</span>
    </button>
    <button onclick="switchTab('settings')" class="tab-btn tap flex flex-col items-center gap-0.5 px-3 py-1 rounded-lg transition" data-tab="settings">
      <span class="text-xl">‚öôÔ∏è</span>
      <span class="text-xs font-heading font-600">Settings</span>
    </button>
  </div>
</nav>

<!-- Modal container -->
<div id="modalContainer"></div>

<script>
// ============================================================
// ITINERARY DATA
// ============================================================
const TRIP_START = new Date('2026-03-23');
const TRIP_END = new Date('2026-04-02');

const DAYS = [
  {
    day: 1, date: 'Mar 23', weekday: 'Sun', flag: 'üá¶üáπ', phase: 'austria',
    title: 'Arrival ‚Üí Salzburg',
    am: 'Land Munich (11 AM) ‚Üí Pick up rental car ‚Üí 1.5 hr scenic drive to Salzburg',
    pm: 'Salzburg Old Town stroll + early family dinner',
    sleep: 'Salzburg', sleepIcon: 'üè∞',
    parking: '‚ö†Ô∏è Hotel garage required', parkingStatus: 'warn',
    ztl: '‚ö†Ô∏è Some central areas restricted ‚Äî confirm hotel access', ztlStatus: 'warn',
    familyTip: 'Old Town is compact & flat ‚Äî perfect evening stroll after a long flight. Kids will love the golden sphere sculpture in Kapitelplatz and the funicular up to the fortress!',
    destinations: [
      { name: 'Hohensalzburg Fortress', url: 'https://www.salzburg.info/en/sights/top10/hohensalzburg-fortress', desc: 'Largest medieval fortress in Europe! Take the funicular up ‚Äî kids love the ride. Knight\'s rooms & puppet museum inside.', star: true },
      { name: 'Getreidegasse', url: 'https://www.salzburg.info/en/sights/top10/getreidegasse', desc: 'Fairy-tale shopping lane with wrought-iron signs. Mozart\'s Birthplace at #9. Get Mozartkugeln (chocolate balls) for the kids!', star: true },
      { name: 'Mirabell Palace & Gardens', url: 'https://www.salzburg.info/en/sights/top10/mirabell-palace-gardens', desc: 'Sound of Music filming location! Kids can run through the Do-Re-Mi gardens. Dwarf Garden is wonderfully weird.', star: true },
      { name: 'Salzburg Cathedral', url: 'https://www.salzburg.info/en/sights/churches-cemeteries/salzburger-cathedral', desc: 'Baroque masterpiece where Mozart was baptized. Free to enter.' },
      { name: 'Residenzplatz', url: 'https://www.salzburg.info/en/sights/squares-streets/residenzplatz', desc: 'Heart of Old Town with Salzburg\'s most beautiful fountain.' }
    ],
    hotels: [
      { name: 'Hotel Sacher Salzburg', url: 'https://www.sacher.com/hotel-sacher-salzburg/', why: 'Grand historic luxury on the Salzach River. Famous Sacher Torte ‚Äî kids will devour it!', parking: 'Valet available', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', perk: 'Spacious rooms, riverside views' },
      { name: 'Sheraton Grand Salzburg', url: 'https://www.marriott.com/hotels/travel/szggs-sheraton-grand-salzburg/', why: 'Best for families ‚Äî large indoor pool, multiple restaurants, rooms with sofa beds.', parking: 'Hotel garage', price: '‚Ç¨‚Ç¨‚Ç¨', perk: 'Indoor pool, kids menu, sofa beds' },
      { name: 'Hotel Bristol Salzburg', url: 'https://www.bristol-salzburg.at/en/', why: 'Family-run 3 generations, 5-star, steps from Mirabell Palace. Award-winning restaurant.', parking: 'Garage ~300m (~‚Ç¨30/night)', price: '‚Ç¨‚Ç¨‚Ç¨', perk: 'Central location, elegant rooms' },
      { name: 'IMLAUER HOTEL PITTER', url: 'https://imlauer.com/hotel-pitter-salzburg/?lang=en', why: 'Classic 4-star on Rainerstra√üe since 1864. Walking distance to Old Town, huge breakfast buffet kids love.', parking: 'Hotel garage available (~‚Ç¨25/night)', price: '‚Ç¨‚Ç¨‚Ç¨', perk: 'Central, spacious family rooms' },
      { name: 'Hotel Goldgasse', url: 'https://www.hotelgoldgasse.at/en/', why: 'Boutique design hotel IN the heart of Old Town. Each room uniquely themed ‚Äî kids love picking their favorite!', parking: 'Public garage nearby (~‚Ç¨28/night)', price: '‚Ç¨‚Ç¨‚Ç¨', perk: 'Old Town location, unique design' }
    ]
  },
  {
    day: 2, date: 'Mar 24', weekday: 'Mon', flag: 'üèî', phase: 'austria',
    title: 'Grossarl Check-in',
    am: 'Breakfast in Salzburg ‚Üí 1 hr drive to Grossarl Valley',
    pm: 'Check-in at Das Edelweiss ‚Üí Spa, waterpark & pool time!',
    sleep: 'Das Edelweiss (1/3)', sleepIcon: '‚õ∑',
    parking: '‚úÖ Free resort parking', parkingStatus: 'ok',
    ztl: '‚úÖ No ZTL', ztlStatus: 'ok',
    familyTip: 'The indoor waterpark has 5 SLIDES and a warm toddler pool. Four age-specific kids clubs mean parents can hit the spa guilt-free!',
    destinations: [
      { name: 'Das Edelweiss Resort', url: 'https://www.edelweiss-grossarl.com/en/', desc: '5-star family resort, Michelin 2 Keys. 7,000m¬≤ Mountain Spa with family & adults-only zones.', star: true },
      { name: 'Indoor Waterpark', url: 'https://www.edelweiss-grossarl.com/en/', desc: '5 water slides, toddler pool, lazy river ‚Äî kids won\'t want to leave!', star: true },
      { name: 'Mountain Cuisine', url: 'https://www.edelweiss-grossarl.com/en/', desc: 'Steak at Sirloin Grill & Dine, sushi at Sakura, or pizza at Cantina & Pizza Inferno.' }
    ],
    hotels: [
      { name: 'Das Edelweiss Mountain Resort', url: 'https://www.edelweiss-grossarl.com/en/', why: '5-star, 3rd generation family-run. Michelin 2 Keys. Indoor waterpark, 4 kids clubs, mountain spa.', parking: 'Free on-site', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', perk: 'Waterpark, 4 kids clubs by age, pizza restaurant' }
    ]
  },
  {
    day: 3, date: 'Mar 25', weekday: 'Tue', flag: 'üèî', phase: 'austria',
    title: 'Alpine Adventure Day',
    am: 'Cable car ride up Panoramabahn ‚Üí Alpine walk or valley exploration',
    pm: 'Mountain dinner at the resort + evening swim',
    sleep: 'Das Edelweiss (2/3)', sleepIcon: '‚õ∑',
    parking: '‚úÖ Car stays parked', parkingStatus: 'ok',
    ztl: '‚úÖ No ZTL', ztlStatus: 'ok',
    familyTip: 'Take the Panoramabahn cable car right from the hotel ‚Äî stunning views! 40+ traditional mountain huts serve hot chocolate and strudel. Guided family walks available.',
    destinations: [
      { name: 'Panoramabahn Cable Car', url: 'https://www.grossarltal.info/en/', desc: 'Steps from hotel! Ride up for panoramic valley views. Spring hiking or snow play.', star: true },
      { name: 'Grossarl Valley Almen', url: 'https://www.grossarltal.info/en/', desc: '40+ traditional alpine huts ‚Äî hot chocolate, apple strudel & Kaiserschmarrn (fluffy shredded pancakes!).', star: true }
    ],
    hotels: []
  },
  {
    day: 4, date: 'Mar 26', weekday: 'Wed', flag: 'üèî', phase: 'austria',
    title: 'Relax or Explore',
    am: 'Slow mountain morning OR half-day Salzburg trip',
    pm: 'Final spa evening ‚Äî soak it all in',
    sleep: 'Das Edelweiss (3/3)', sleepIcon: '‚õ∑',
    parking: '‚úÖ Easy village parking', parkingStatus: 'ok',
    ztl: '‚úÖ No ZTL', ztlStatus: 'ok',
    familyTip: 'Option A: Full kids club + spa day for parents. Option B: Hellbrunn Palace has trick water fountains that spray unsuspecting visitors ‚Äî kids LOVE it (30 min drive).',
    destinations: [
      { name: 'Hellbrunn Palace', url: 'https://www.hellbrunn.at/en', desc: '30 min from resort. Trick water fountains ‚Äî kids will be in hysterics! Sound of Music gazebo too.', star: true },
      { name: 'Resort Spa Day', url: 'https://www.edelweiss-grossarl.com/en/', desc: 'Last chance for waterpark, infinity pool & mountain views.', star: true }
    ],
    hotels: []
  },
  {
    day: 5, date: 'Mar 27', weekday: 'Thu', flag: 'üöó', phase: 'transition',
    title: '"Alps to Tuscany" ‚≠ê Big Drive Day',
    am: 'Scenic 5 hr drive south ‚Üí Coffee stop in Innsbruck + Brenner Pass into Italy',
    pm: 'Arrive Val d\'Orcia ‚Äî Tuscan countryside welcome!',
    sleep: 'Val d\'Orcia (1/3)', sleepIcon: 'üåª',
    parking: '‚úÖ On-site estate parking', parkingStatus: 'ok',
    ztl: '‚úÖ Stay outside towns ‚Äî no issues', ztlStatus: 'ok',
    familyTip: 'Big drive day! Pack snacks, download movies, bring coloring books. Innsbruck coffee stop breaks it up. Brenner Pass is exciting ‚Äî you\'re crossing the Alps! Let kids spot the Italy border signs.',
    driveRoute: [
      'Grossarl ‚Üí Innsbruck (~2 hrs): Scenic motorway through alpine valleys',
      'Innsbruck Old Town ‚Äî Quick coffee & leg stretch. Golden Roof fun to spot.',
      'Innsbruck ‚Üí Brenner Pass (~30 min): Cross into Italy!',
      'Brenner ‚Üí Val d\'Orcia (~4 hrs): A22 south through Trentino, A1 toward Siena',
      'Total: ~5 hours driving + stops'
    ],
    midwayStops: [
      {
        city: 'Bolzano (Bozen)', emoji: 'üèîÔ∏è', driveFromPrev: '~2.5 hrs from Grossarl',
        driveToNext: '~3.5 hrs to Val d\'Orcia',
        pitch: 'Where Austria meets Italy! Bilingual city with Dolomite views, amazing food markets, and √ñtzi the Iceman ‚Äî a 5,300-year-old mummy.',
        whyStop: 'Splits the drive perfectly. √ñtzi museum is incredible for kids. Mix of Austrian & Italian culture ‚Äî strudel AND gelato! Cable car to Renon for mountain views.',
        highlights: [
          { name: '√ñtzi the Iceman Museum', desc: 'South Tyrol Museum ‚Äî see a 5,300-year-old mummy and all his belongings. Kids are fascinated!' },
          { name: 'Funivia del Renon', desc: 'Cable car from city center to Renon/Ritten ‚Äî panoramic Dolomite views in 12 minutes. Earth pyramids hike at the top.' },
          { name: 'Piazza Walther & Market', desc: 'Beautiful main square. Daily fruit market on Piazza delle Erbe ‚Äî sample speck, apples, strudel, local cheeses.' }
        ],
        hotels: [
          { name: 'Parkhotel Laurin', url: 'https://www.laurin.it/en/', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', desc: 'Art Nouveau gem in the city center. Pool, garden, gourmet restaurant. Elegant family rooms.' },
          { name: 'Hotel Greif', url: 'https://www.greif.it/en/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: 'Design hotel on Piazza Walther. Each room designed by a different artist. Rooftop bar.' },
          { name: 'Stadt Hotel Citt√†', url: 'https://www.hotelcitta.info/en/', price: '‚Ç¨‚Ç¨', desc: 'Central, modern, great value. Steps from √ñtzi museum and piazza. Family rooms available.' }
        ],
        ztlNote: '‚ö†Ô∏è ZTL in old town ‚Äî park at Parking Walther (underground, central) or P7 near train station.'
      },
      {
        city: 'Trento', emoji: 'üî¨', driveFromPrev: '~3 hrs from Grossarl',
        driveToNext: '~3 hrs to Val d\'Orcia',
        pitch: 'Renaissance jewel with the spectacular MUSE science museum ‚Äî one of Italy\'s best interactive museums for families.',
        whyStop: 'MUSE science museum is world-class and incredibly kid-friendly. Beautiful frescoed buildings. Buonconsiglio Castle has medieval frescoes kids love. Great food scene.',
        highlights: [
          { name: 'MUSE Science Museum', desc: 'Renzo Piano-designed interactive museum. Dinosaurs, glacier exhibits, tropical greenhouse, kids\' zones. Best family museum in northern Italy!' },
          { name: 'Buonconsiglio Castle', desc: 'Largest castle complex in Trentino. Medieval frescoes of the months ‚Äî vivid scenes of daily life 700 years ago.' },
          { name: 'Piazza Duomo', desc: 'Stunning frescoed facades, Neptune fountain, and the Cathedral. Charming cafes for aperitivo.' }
        ],
        hotels: [
          { name: 'Grand Hotel Trento', url: 'https://www.grandhoteltrento.com/en/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: '4-star in Art Nouveau building. Central, elegant, great breakfast. Steps from Piazza Duomo.' },
          { name: 'Hotel Aquila d\'Oro', url: 'https://www.aquiladoro.it/en/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: 'Boutique hotel in a 16th-century building. Heart of old town, charming rooms, excellent restaurant.' },
          { name: 'NH Trento', url: 'https://www.nh-hotels.com/en/hotel/nh-trento', price: '‚Ç¨‚Ç¨', desc: 'Modern 4-star near MUSE museum. Pool, parking, family-friendly. Great base for the science museum.' }
        ],
        ztlNote: '‚ö†Ô∏è ZTL in center ‚Äî park at Autosilo Buonconsiglio or P1 Ex-Zuffo (both near center, well-signed).'
      },
      {
        city: 'Lake Garda ‚Äî Riva del Garda', emoji: '‚õµ', driveFromPrev: '~3.5 hrs from Grossarl',
        driveToNext: '~3.5 hrs to Val d\'Orcia',
        pitch: 'Northern tip of Italy\'s largest lake ‚Äî dramatic cliffs, crystal water, and a relaxed lakeside vibe. Perfect overnight reset.',
        whyStop: 'Gorgeous lakeside walks after a long drive. Kids can splash at the beach. Climb the Bastione fortress for sunset views. Fresh lake fish for dinner!',
        highlights: [
          { name: 'Riva del Garda Waterfront', desc: 'Stroll the palm-lined promenade. Kids play at the pebble beach. Dramatic mountain backdrop.' },
          { name: 'Bastione Fortress', desc: '15-minute walk up for panoramic lake views ‚Äî especially magical at sunset. Free to visit.' },
          { name: 'MAG Museum', desc: 'Art & history in the lakeside Rocca fortress. Rotating exhibits, beautiful setting.' }
        ],
        hotels: [
          { name: 'Hotel Du Lac et Du Parc', url: 'https://www.dulacetduparc.com/en/', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', desc: 'Grand 4-star resort with thermal pools, huge park, lake views. Multiple restaurants, kids\' activities.' },
          { name: 'Lido Palace', url: 'https://www.lido-palace.it/en/', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨‚Ç¨', desc: 'Belle √âpoque 5-star luxury. Infinity pool, world-class spa, lake-view suites. Pure indulgence.' },
          { name: 'Hotel Sole', url: 'https://www.hotelsole.net/en/', price: '‚Ç¨‚Ç¨', desc: 'Right on the harbor with lake-view terrace. Charming rooms, great restaurant, family-friendly.' }
        ],
        ztlNote: '‚úÖ No ZTL in Riva ‚Äî easy parking at the lakefront lots or hotel parking.'
      }
    ],
    destinations: [
      { name: 'Innsbruck Old Town', url: 'https://www.innsbruck.info/en/', desc: 'Quick coffee & leg stretch. Golden Roof (Goldenes Dachl). Mountains tower over the city!', star: true },
      { name: 'Val d\'Orcia UNESCO Site', url: 'https://www.italia.it/en/tuscany/things-to-do/val-orcia', desc: 'Rolling hills, cypress trees, medieval villages.' }
    ],
    hotels: [
      { name: 'Rosewood Castiglion del Bosco', url: 'https://www.rosewoodhotels.com/en/castiglion-del-bosco', why: 'Ultra-luxury Tuscan resort. Vineyards, spa, golf, stunning suites.', parking: 'Free estate parking', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨‚Ç¨', perk: 'Kids programs, pool, cooking classes' },
      { name: 'Adler Thermae Spa Resort', url: 'https://www.adler-thermae.com/en/', why: 'Luxury thermal spa in Bagno Vignoni. Central Val d\'Orcia.', parking: 'Free on-site', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', perk: 'Thermal pools, kids activities' },
      { name: 'Tenuta Santo Pietro', url: 'https://www.tenutasantopietro.com/', why: 'Family-friendly luxury agriturismo. Cooking classes, truffle hunting!', parking: 'Free on-site', price: '‚Ç¨‚Ç¨‚Ç¨', perk: 'Cooking classes, farm animals, truffle hunts' },
      { name: 'Castello Banfi ‚Äì Il Borgo', url: 'https://www.castellobanfiwineresort.it/en/', why: 'Relais & Chateaux wine estate near Montalcino. Historic castle.', parking: 'Estate parking', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', perk: 'Castle tours, vineyard walks' },
      { name: 'L\'Olmo', url: 'https://www.olmopienza.it/', why: 'Boutique 4-star just outside Pienza, only 8 rooms. Pool, rolling fields.', parking: 'Free on-site', price: '‚Ç¨‚Ç¨‚Ç¨', perk: 'Intimate, quiet, pool' }
    ],
    alternatives: [
      {
        city: 'Chianti', emoji: 'üç∑', driveFromPrev: '~4.5 hrs from Grossarl',
        pitch: 'Wine country between Florence & Siena ‚Äî rolling vineyards, medieval castles, and the most charming hill villages in Tuscany.',
        whySwap: 'Closer to Florence for the final days. More wine-focused. Greve in Chianti is a foodie paradise.',
        highlights: [
          { name: 'Greve in Chianti', desc: 'Heart of Chianti Classico ‚Äî triangular piazza, Saturday market, wine tastings everywhere.' },
          { name: 'Castello di Verrazzano', desc: 'Historic vineyard estate ‚Äî wine + olive oil tastings with stunning views. Family-friendly tours.' },
          { name: 'Radda in Chianti', desc: 'Perfectly preserved medieval village on a hilltop ridge. Tiny lanes, artisan shops, incredible views.' }
        ],
        hotels: [
          { name: 'Castello di Spaltenna', url: 'https://www.spaltenna.it/', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', desc: 'Medieval castle turned luxury hotel in Gaiole. Pool, spa, vineyard views.' },
          { name: 'Villa Bordoni', url: 'https://www.villabordoni.com/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: 'Boutique villa in Greve. Excellent restaurant, infinity pool, cooking classes.' },
          { name: 'Borgo San Felice', url: 'https://www.borgosanfelice.com/en/index', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', desc: 'Relais & Chateaux resort in a restored medieval hamlet. Pool, spa, Michelin dining, vineyard views.' },
          { name: 'Villa Le Barone', url: 'https://www.villalebarone.com/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: 'Charming 28-room villa in Panzano. Pool with panoramic views, great breakfast with local products.' }
        ],
        ztlNote: '‚úÖ Most Chianti villages have no ZTL ‚Äî park near town centers easily.'
      },
      {
        city: 'Cortona', emoji: 'üåÖ', driveFromPrev: '~5 hrs from Grossarl',
        pitch: 'Ancient Etruscan hilltop city made famous by "Under the Tuscan Sun." Stunning Lake Trasimeno views.',
        whySwap: 'More off-the-beaten-path. Fewer crowds than Val d\'Orcia. Amazing sunsets over the valley. Close to Umbria too!',
        highlights: [
          { name: 'Piazza della Repubblica', desc: 'Main square with cafes, gelaterias, and the stunning Palazzo Comunale steps.' },
          { name: 'Fortezza del Girifalco', desc: 'Medici fortress at the top ‚Äî panoramic views of Lake Trasimeno and the entire valley.' },
          { name: 'MAEC Museum', desc: 'Etruscan artifacts spanning 3,000 years ‚Äî the bronze chandelier is extraordinary.' }
        ],
        hotels: [
          { name: 'Il Falconiere', url: 'https://www.ilfalconiere.it/en/', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', desc: 'Relais & Chateaux with Michelin-star dining. Pool, vineyard, 17th-century villa.' },
          { name: 'Hotel San Michele', url: 'https://www.hotelsanmichele.net/', price: '‚Ç¨‚Ç¨', desc: 'Renaissance palazzo in the heart of town. Charming rooms, unbeatable location.' },
          { name: 'Villa Marsili', url: 'https://www.villamarsili.net/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: '18th-century palace in town center. Elegant rooms, panoramic terrace with sweeping valley views.' },
          { name: 'Relais La Corte dei Papi', url: 'https://www.lacortedeipapi.com/en/', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', desc: 'Luxury countryside retreat with pool and spa. Vineyard setting, just 5 min drive to Cortona center.' }
        ],
        ztlNote: '‚ö†Ô∏è ZTL in historic center ‚Äî park at Parcheggio Spirale (outside walls, escalator up to town).'
      },
      {
        city: 'Siena', emoji: 'üèá', driveFromPrev: '~5 hrs from Grossarl',
        pitch: 'Italy\'s best-preserved medieval city. The shell-shaped Piazza del Campo is one of Europe\'s greatest squares.',
        whySwap: 'More "city" feel than countryside. The Duomo is jaw-dropping. Great restaurants and gelaterias. Kids love the Palio stories.',
        highlights: [
          { name: 'Piazza del Campo', desc: 'One of the world\'s most beautiful squares ‚Äî shell-shaped, tilted, surrounded by medieval palaces. Site of the famous Palio horse race.' },
          { name: 'Siena Cathedral (Duomo)', desc: 'Striped marble masterpiece. The floor mosaics alone are worth the visit. Climb to the panoramic terrace!' },
          { name: 'Torre del Mangia', desc: '88m tower overlooking Piazza del Campo ‚Äî 400 steps to the top for incredible views. Kids count the steps!' }
        ],
        hotels: [
          { name: 'Grand Hotel Continental', url: 'https://www.royaldemeure.com/grand-hotel-continental-siena/', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', desc: 'Only 5-star in Siena\'s center. UNESCO heritage building with frescoed ceilings.' },
          { name: 'Hotel Athena', url: 'https://www.hotelathena.com/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: 'Great views from terrace, OUTSIDE ZTL with free parking. Family rooms available.' },
          { name: 'Palazzo Ravizza', url: 'https://www.palazzoravizza.it/en/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: 'Family-run since 1929. Garden with panoramic views, elegant rooms. Inside the walls but peaceful.' },
          { name: 'La Certosa di Maggiano', url: 'https://www.lacertosadimaggiano.com/', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', desc: 'Former 14th-century Carthusian monastery. Pool, gardens, serene atmosphere. Just outside the center.' }
        ],
        ztlNote: 'üî¥ Strict ZTL ‚Äî park OUTSIDE the walls! Parcheggio Il Campo (underground) or Fortezza (near center). Walk or take minibus in.'
      }
    ]
  },
  {
    day: 6, date: 'Mar 28', weekday: 'Fri', flag: 'üáÆüáπ', phase: 'italy',
    title: 'Pienza & Montepulciano',
    am: 'Pienza ‚Äî cheese tasting, Renaissance streets, panoramic views',
    pm: 'Montepulciano ‚Äî tower climb + vineyard dinner',
    sleep: 'Val d\'Orcia (2/3)', sleepIcon: 'üåª',
    parking: '‚ö†Ô∏è Park OUTSIDE town walls', parkingStatus: 'warn',
    ztl: '‚ö†Ô∏è Do NOT drive into historic town centers!', ztlStatus: 'warn',
    familyTip: 'Pienza\'s pecorino cheese shops have free samples everywhere! In Montepulciano, climb the Palazzo Comunale tower for a 360¬∞ view. Streets named \'Love\', \'Kiss\' and \'Good Luck\'!',
    destinations: [
      { name: 'Pienza', url: 'https://www.discovertuscany.com/valdorcia/visit-pienza.html', desc: 'The "Ideal Renaissance City" ‚Äî pecorino cheese capital! Walk behind the cathedral for jaw-dropping views.', star: true },
      { name: 'Montepulciano', url: 'https://www.discovertuscany.com/montepulciano/', desc: 'Medieval hilltop town. Climb Palazzo Comunale tower for 360¬∞ views. Caffe Poliziano panoramic terrace.', star: true },
      { name: 'Ristorante Daria (Monticchiello)', url: 'https://www.discovertuscany.com/montepulciano/', desc: 'Authentic Tuscan dishes. Book ahead!' },
      { name: 'Il Rossellino (Pienza)', url: 'https://www.discovertuscany.com/valdorcia/visit-pienza.html', desc: 'Traditional cooking in charming piazza.' },
      { name: 'La Bandita Townhouse (Pienza)', url: 'https://www.discovertuscany.com/valdorcia/visit-pienza.html', desc: 'Modern Tuscan with international twists.' }
    ],
    hotels: [],
    alternatives: [
      {
        city: 'San Gimignano', emoji: 'üóº', driveFromPrev: '~1.5 hrs from Chianti / ~2 hrs from Val d\'Orcia',
        pitch: 'The "Medieval Manhattan" ‚Äî 14 stone towers still standing from the original 72. UNESCO World Heritage. Gelato world champion is here!',
        whySwap: 'More dramatic skyline than Pienza. The tower views are unforgettable. Gelateria Dondoli won World Gelato Champion ‚Äî twice!',
        highlights: [
          { name: 'Torre Grossa', desc: 'The tallest tower (54m) ‚Äî climb for 360¬∞ views of rolling Tuscan countryside and all the other towers.' },
          { name: 'Gelateria Dondoli', desc: 'Two-time World Gelato Champion. Try the Crema di Santa Fina (saffron) or Raspberry + Rosemary!' },
          { name: 'Piazza della Cisterna', desc: 'Triangular piazza with a 13th-century well. Surrounded by towers and medieval houses.' }
        ],
        hotels: [
          { name: 'Hotel L\'Antico Pozzo', url: 'https://www.anticopozzo.com/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: '15th-century townhouse in the heart of town. Vaulted ceilings, terrace views.' },
          { name: 'Villasanpaolo Resort', url: 'https://www.villasanpaolo.com/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: 'Outside walls with pool and panoramic tower views. Free parking!' },
          { name: 'La Collegiata', url: 'https://www.lacollegiatahotel.it/', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', desc: 'Converted Franciscan convent with pool and lush gardens. Stunning tower views. Shuttle to town.' },
          { name: 'Hotel Leon Bianco', url: 'https://www.leonbianco.com/', price: '‚Ç¨‚Ç¨', desc: 'Budget-friendly right on Piazza della Cisterna. Medieval atmosphere, friendly staff, unbeatable location.' }
        ],
        ztlNote: 'üî¥ ZTL in center ‚Äî park at P1 or P2 outside the walls (well-signed). ~5 min walk to Porta San Giovanni.'
      },
      {
        city: 'Lucca', emoji: 'üö≤', driveFromPrev: '~2.5 hrs from Val d\'Orcia',
        pitch: 'The most livable Tuscan city ‚Äî completely intact Renaissance walls you can bike on top of! Puccini\'s birthplace.',
        whySwap: 'Much more relaxed than other Tuscan towns. The wall-top bike ride is magical for families. Excellent food scene without tourist markup.',
        highlights: [
          { name: 'City Wall Bike Ride', desc: '4.2km loop on top of the Renaissance walls ‚Äî shaded by trees, views into gardens. Rent bikes at any gate!' },
          { name: 'Piazza dell\'Anfiteatro', desc: 'Oval piazza built on the ruins of a Roman amphitheater ‚Äî the shape is perfectly preserved.' },
          { name: 'Torre Guinigi', desc: 'A medieval tower with OAK TREES growing on top! 230 steps up for amazing views.' }
        ],
        hotels: [
          { name: 'Grand Universe Lucca', url: 'https://www.granduniverselucca.com/', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', desc: 'Autograph Collection hotel on Piazza del Giglio. Rooftop terrace with Duomo views.' },
          { name: 'Hotel Ilaria', url: 'https://www.hotelilaria.com/', price: '‚Ç¨‚Ç¨', desc: 'Inside the walls, quiet courtyard, free bikes to borrow. Great family value.' },
          { name: 'Palazzo Dipinto', url: 'https://www.palazzodipinto.com/en/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: 'Design hotel in a restored palazzo. Modern elegance inside the walls, rooftop terrace, charming courtyard.' },
          { name: 'San Luca Palace Hotel', url: 'https://www.sanlucapalace.com/en/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: '4-star near Piazza Napoleone. Refined rooms, excellent breakfast, convenient to everything.' }
        ],
        ztlNote: '‚ö†Ô∏è ZTL inside the walls ‚Äî but plentiful parking just OUTSIDE the gates. Walk or bike in!'
      }
    ]
  },
  {
    day: 7, date: 'Mar 29', weekday: 'Sat', flag: 'üáÆüáπ', phase: 'italy',
    title: 'Tuscan Slow Day',
    am: 'Farm visit or countryside drive ‚Äî gelato stops mandatory',
    pm: 'Sunset dinner with Val d\'Orcia views',
    sleep: 'Val d\'Orcia (3/3)', sleepIcon: 'üåª',
    parking: '‚úÖ No driving needed from estate', parkingStatus: 'ok',
    ztl: '‚úÖ No issues from countryside', ztlStatus: 'ok',
    familyTip: 'Visit Podere il Casale ‚Äî kids can meet 1,000+ sheep and watch pecorino cheese being made! Bagno Vignoni has a Roman thermal pool in the town square ‚Äî surreal.',
    destinations: [
      { name: 'Montalcino', url: 'https://www.discovertuscany.com/montalcino/guide-to-montalcino.html', desc: 'City of Brunello wine. Climb the 14th-century fortress ‚Äî wine tasting inside (grape juice for kids!).', star: true },
      { name: 'Vitaleta Chapel', url: 'https://www.discovertuscany.com/valdorcia/', desc: 'THE iconic Tuscan photo ‚Äî tiny white church on a hill between cypress trees.', star: true },
      { name: 'Bagno Vignoni', url: 'https://www.discovertuscany.com/valdorcia/', desc: 'Ancient Roman thermal pool in the town square! Steaming water fascinates kids.' },
      { name: 'Podere il Casale', url: 'https://www.discovertuscany.com/valdorcia/', desc: 'Farm with 1,000+ sheep ‚Äî watch pecorino being made! Picnic with views.' },
      { name: 'San Quirico d\'Orcia', url: 'https://www.discovertuscany.com/valdorcia/', desc: 'Romanesque church, Horti Leonini Renaissance gardens.' }
    ],
    hotels: [],
    alternatives: [
      {
        city: 'Volterra', emoji: '‚ö°', driveFromPrev: '~1.5 hrs from Val d\'Orcia',
        pitch: 'Etruscan hilltop city older than Rome itself. Dramatic cliff-edge setting. Famous for alabaster craftsmanship.',
        whySwap: 'More ancient history than other Tuscan towns (3,000+ years!). Less crowded. The Etruscan ruins and Roman theater are unique. Twilight fans ‚Äî this is the Volturi city!',
        highlights: [
          { name: 'Roman Theater', desc: 'Remarkably preserved 1st-century BC theater ‚Äî you can see it from the viewing terrace above for free.' },
          { name: 'Alabaster Workshops', desc: 'Watch artisans carve translucent stone ‚Äî a tradition since the Etruscans. Kids can try!' },
          { name: 'Le Balze Cliffs', desc: 'Dramatic eroded cliffs on the edge of town ‚Äî churches have literally fallen off the edge over centuries.' }
        ],
        hotels: [
          { name: 'Park Hotel Le Fonti', url: 'https://www.parkhotellefonti.com/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: 'Panoramic pool overlooking the valley. Just outside the walls with easy parking.' },
          { name: 'Hotel La Locanda', url: 'https://www.hotel-lalocanda.com/', price: '‚Ç¨‚Ç¨', desc: 'Boutique B&B in a restored medieval building. Central, charming, family-run.' },
          { name: 'Hotel San Lino', url: 'https://www.hotelsanlinovolterra.com/', price: '‚Ç¨‚Ç¨', desc: 'Former 17th-century convent with pool. Central location, courtyard garden, free parking nearby.' },
          { name: 'Agriturismo Marcampo', url: 'https://www.agriturismo-marcampo.com/', price: '‚Ç¨‚Ç¨', desc: 'Working farm with vineyard just outside walls. Wine tastings, olive oil, pool with valley views.' }
        ],
        ztlNote: '‚ö†Ô∏è ZTL in center ‚Äî park at Parcheggio Docciola (free! below the walls) or paid lots near Porta Fiorentina.'
      },
      {
        city: 'Arezzo', emoji: 'üé®', driveFromPrev: '~1 hr from Val d\'Orcia',
        pitch: 'Roberto Benigni\'s "Life is Beautiful" was filmed here! Antique market capital of Italy. Stunning Piero della Francesca frescoes.',
        whySwap: 'Authentic Italian city that\'s NOT a tourist town. First-Saturday antique market is legendary. Great food, lower prices. Easy day trip to Cortona.',
        highlights: [
          { name: 'Piazza Grande', desc: '"Life is Beautiful" was filmed here! Sloped medieval piazza ‚Äî Italy\'s best antique fair first Sunday of every month.' },
          { name: 'Basilica di San Francesco', desc: 'Piero della Francesca\'s "Legend of the True Cross" frescoes ‚Äî one of Italy\'s greatest artwork cycles.' },
          { name: 'Fortezza Medicea', desc: 'Medici fortress at the top of town ‚Äî free park with panoramic views. Kids run wild on the grass.' }
        ],
        hotels: [
          { name: 'Graziella Patio Hotel', url: 'https://www.hotelgraziellapatio.it/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: 'Boutique hotel in 16th-century palazzo. Central, elegant, exceptional breakfast.' },
          { name: 'Hotel Continentale', url: 'https://www.hotelcontinentale.com/', price: '‚Ç¨‚Ç¨', desc: 'On Piazza Guido Monaco, steps from the train station. Modern, family-friendly.' },
          { name: 'Badia di Pomaio', url: 'https://www.badiadipomaio.it/', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', desc: 'Restored 11th-century abbey with infinity pool. Panoramic hilltop setting, 5 min from center.' },
          { name: 'Hotel Patio', url: 'https://www.hotelpatio.it/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: 'Boutique hotel in historic palazzo near Piazza Grande. Stylish rooms, courtyard, great breakfast.' }
        ],
        ztlNote: '‚ö†Ô∏è ZTL in center ‚Äî park at Parcheggio Pietri (covered, near center) or free lots near the Fortezza.'
      }
    ]
  },
  {
    day: 8, date: 'Mar 30', weekday: 'Sun', flag: 'üáÆüáπ', phase: 'italy',
    title: 'Verona ‚Äî Romeo & Juliet City',
    am: '2.5-3 hr drive Val d\'Orcia ‚Üí Verona',
    pm: 'Arena di Verona (older than the Colosseum!) + Piazza evening stroll',
    sleep: 'Verona ‚Äî OUTSIDE ZTL', sleepIcon: 'üèõ',
    parking: '‚ö†Ô∏è Hotel garage OUTSIDE old town ‚Äî critical!', parkingStatus: 'warn',
    ztl: '‚ö†Ô∏è Stay OUTSIDE ZTL zone ‚Äî walk into old town', ztlStatus: 'warn',
    familyTip: 'The Arena held gladiator fights and 30,000 spectators ‚Äî it\'s like a smaller Colosseum! Under 8s are FREE. Visit Juliet\'s balcony for the photo op. Secret: Roman ruins hide in the Benetton store basement on Via Mazzini!',
    parkingStrategy: 'Corso Porta Nuova from the south ‚Äî NOT in ZTL. Park at Parcheggio Cittadella (underground, modern) ‚Äî 2-3 min walk to Arena, zero ZTL risk.',
    destinations: [
      { name: 'Arena di Verona', url: 'https://arenaverona.org/en', desc: '1st century AD ‚Äî best preserved amphitheater in the world! Adults ~‚Ç¨12, kids under 8 FREE.', star: true },
      { name: 'Juliet\'s House', url: 'https://www.visitverona.it/en', desc: 'The famous balcony! Touch Juliet\'s statue for luck.', star: true },
      { name: 'Piazza delle Erbe', url: 'https://www.visitverona.it/en', desc: 'Ancient Roman forum turned lively market. Gelato & frescoed buildings.', star: true },
      { name: 'Piazza Bra', url: 'https://www.arena.it/en/arena-verona-opera-festival/get-ready-for-the-opera/visiting-verona/', desc: 'Grand main square, cafes along the "Liston" promenade.' },
      { name: 'Lamberti Tower', url: 'https://www.visitverona.it/en', desc: 'Tallest in Verona ‚Äî amazing views. Kids love the climb.' }
    ],
    hotels: [
      { name: 'Hotel Indigo Verona', url: 'https://www.ihg.com/hotelindigo/hotels/us/en/verona/vrndi/hoteldetail', why: 'Elegant 1920s Liberty-style. 10-min walk to Arena.', parking: 'Available, outside ZTL', price: '‚Ç¨‚Ç¨‚Ç¨', perk: 'Walkable, stylish rooms' },
      { name: 'Best Western CTC Verona', url: 'https://www.ctchotelverona.com/en/', why: 'Spacious rooms, free shuttle to center. Ample parking.', parking: 'Free ample parking', price: '‚Ç¨‚Ç¨‚Ç¨', perk: 'Free shuttle, restaurant' },
      { name: 'Hotel Villa del Quar', url: 'https://hotelvilladelquar.it/en/', why: 'Relais & Chateaux 5-star in Valpolicella vineyards. Pool, gourmet restaurant, just 6km from center.', parking: 'Free private parking', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', perk: 'Vineyard setting, pool, gourmet dining' },
      { name: 'Hotel Due Torri', url: 'https://hotelduetorri.duetorrihotels.com/en', why: '5-star grand hotel on Piazza Sant\'Anastasia since 1882. Opulent interiors, central location.', parking: 'Valet parking available', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', perk: 'Historic luxury, central piazza' },
      { name: 'Hotel Colomba d\'Oro', url: 'https://colombahotel.com/en/', why: 'Charming 4-star in a converted 14th-century chapel. Steps from Arena di Verona.', parking: 'Nearby garage available', price: '‚Ç¨‚Ç¨‚Ç¨', perk: 'Historic charm, steps to Arena' }
    ],
    alternatives: [
      {
        city: 'Bologna', emoji: 'üçù', driveFromPrev: '~2 hrs from Val d\'Orcia',
        pitch: 'Italy\'s food capital. The oldest university in the world. Miles of covered porticoes (UNESCO). Seriously underrated!',
        whySwap: 'Best food in Italy, period. Rag√π, tortellini, mortadella ‚Äî all born here. More "real Italian life" than Verona. The porticoes mean you\'re covered even in rain!',
        highlights: [
          { name: 'Mercato di Mezzo', desc: 'Indoor food market in medieval streets ‚Äî taste fresh pasta, mortadella, Parmigiano Reggiano, gelato.' },
          { name: 'Two Towers (Due Torri)', desc: 'Climb Torre degli Asinelli (498 steps!) for panoramic views. The leaning Garisenda tower is Italy\'s other leaning tower.' },
          { name: 'Porticoes Walk', desc: '40km of covered arcades (UNESCO!) ‚Äî the longest in the world. Walk from Piazza Maggiore to the hilltop Sanctuary of San Luca.' }
        ],
        hotels: [
          { name: 'Grand Hotel Majestic', url: 'https://www.grandhotelmajestic.duetorrihotels.com/', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', desc: '5-star in an 18th-century palazzo on Via Indipendenza. Frescoed ceilings, central location.' },
          { name: 'Hotel Touring', url: 'https://www.hoteltouring.it/', price: '‚Ç¨‚Ç¨', desc: 'Great value near the station. Modern, family rooms, easy parking nearby.' },
          { name: 'Art Hotel Orologio', url: 'https://www.art-hotel-orologio.it/en/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: 'Boutique hotel facing Piazza Maggiore clock tower. Can\'t beat the location for sightseeing.' },
          { name: 'Hotel Corona d\'Oro', url: 'https://www.hco.it/en/', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', desc: 'Historic palace hotel on Via Oberdan. Art Nouveau details, central, elegant breakfast salon.' }
        ],
        ztlNote: 'üî¥ Large ZTL zone in center ‚Äî park at Parcheggio Staveco or Tanari (outside ZTL). Take the free shuttle or walk.'
      },
      {
        city: 'Padua (Padova)', emoji: 'üéì', driveFromPrev: '~2.5 hrs from Val d\'Orcia',
        pitch: 'Home of Giotto\'s Scrovegni Chapel (one of the world\'s greatest artworks). Oldest botanical garden in the world. Venice is 30 min by train!',
        whySwap: 'The Scrovegni Chapel alone is worth the detour. Much cheaper and less crowded than Venice. Take a day trip to Venice by train (no car/parking stress!).',
        highlights: [
          { name: 'Scrovegni Chapel', desc: 'Giotto\'s 1305 frescoes ‚Äî considered the birth of Western art. MUST book timed tickets in advance!' },
          { name: 'Prato della Valle', desc: 'One of Europe\'s largest squares ‚Äî an island surrounded by a canal with 78 statues. Kids love running around it.' },
          { name: 'Day Trip to Venice', desc: '30 min by train! Leave the car in Padua and explore Venice stress-free. No parking nightmares.' }
        ],
        hotels: [
          { name: 'NH Padova', url: 'https://www.nh-hotels.com/hotel/nh-padova', price: '‚Ç¨‚Ç¨‚Ç¨', desc: 'Modern 4-star near the center. Pool, parking, family rooms. Easy walk to Scrovegni.' },
          { name: 'Belludi 37', url: 'https://www.belludi37.it/', price: '‚Ç¨‚Ç¨', desc: 'Stylish boutique B&B on Prato della Valle. Bikes available, excellent breakfast.' },
          { name: 'Methis Hotel & SPA', url: 'https://www.methishotel.com/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: 'Design hotel with spa on the river. Modern rooms, excellent restaurant, near Prato della Valle.' },
          { name: 'Hotel Grand\'Italia', url: 'https://www.hotelgranditalia.it/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: 'Elegant 4-star facing Basilica di Sant\'Antonio. Classic style, rooftop terrace, family rooms.' }
        ],
        ztlNote: '‚ö†Ô∏è ZTL in center ‚Äî park at Parcheggio Rabin (near Scrovegni Chapel) or the train station garage.'
      },
      {
        city: 'Lake Garda', emoji: 'üèñ', driveFromPrev: '~2.5 hrs from Val d\'Orcia',
        pitch: 'Italy\'s largest lake with dramatic mountain backdrop. Gardaland theme park! Lemon groves, castles, and crystal-clear water.',
        whySwap: 'Perfect family destination ‚Äî Gardaland (Italy\'s #1 theme park), beaches, boat rides. Sirmione\'s castle-on-the-lake is magical. More relaxing than a city stop.',
        highlights: [
          { name: 'Sirmione', desc: 'Fairy-tale peninsula with a moated Scaliger castle. Thermal springs, gelato walks along the lake.' },
          { name: 'Gardaland', desc: 'Italy\'s biggest theme park ‚Äî roller coasters, water rides, LEGOLAND Water Park. Full day of family fun.' },
          { name: 'Malcesine', desc: 'Take the cable car to Monte Baldo (1,760m!) for breathtaking lake views. Kids love the ride.' }
        ],
        hotels: [
          { name: 'Lefay Resort & Spa', url: 'https://www.lefayresorts.com/en/lago-di-garda/', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨‚Ç¨', desc: 'Luxury wellness resort overlooking the lake. Infinity pool, spa, stunning views. Family suites.' },
          { name: 'Hotel Sirmione', url: 'https://www.termedisirmione.com/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: 'Lakefront thermal hotel in Sirmione. Pool, spa, direct lake access. Central location.' },
          { name: 'Grand Hotel Fasano', url: 'https://www.ghf.it/en/', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨‚Ç¨', desc: 'Historic grand hotel in Gardone Riviera. Private beach, Michelin restaurant, lush botanical gardens.' },
          { name: 'Lido Palace', url: 'https://www.lido-palace.it/en/', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨‚Ç¨', desc: 'Belle √âpoque luxury in Riva del Garda. Lake-view infinity pool, world-class spa, panoramic restaurant.' }
        ],
        ztlNote: '‚úÖ Most lakeside towns have no ZTL ‚Äî easy parking, especially in off-season (March). Sirmione has limited entry in summer but fine in spring.'
      }
    ]
  },
  {
    day: 9, date: 'Mar 31', weekday: 'Mon', flag: 'üáÆüáπ', phase: 'italy',
    title: 'Bologna ‚Äî Italy\'s Food Capital üçù',
    am: 'Last Verona gelato ‚Üí 1.5 hr drive to Bologna',
    pm: 'Explore the porticoes, Two Towers, Mercato di Mezzo ‚Äî eat EVERYTHING',
    sleep: 'Bologna', sleepIcon: 'üèõ',
    parking: '‚ö†Ô∏è Park OUTSIDE ZTL ‚Äî use Parcheggio Staveco or Tanari', parkingStatus: 'warn',
    ztl: 'üî¥ Large ZTL in center ‚Äî park outside, walk or shuttle in', ztlStatus: 'danger',
    familyTip: 'Bologna is THE food capital of Italy ‚Äî this is where rag√π, tortellini, and mortadella were born! Mercato di Mezzo is heaven for foodies. The Two Towers climb (498 steps!) is epic. 40km of covered porticoes mean rain doesn\'t matter!',
    destinations: [
      { name: 'Mercato di Mezzo', url: 'https://www.mercatodimezzo.it/', desc: 'Indoor food market in medieval streets ‚Äî fresh pasta, mortadella, Parmigiano Reggiano, the best gelato. Taste EVERYTHING!', star: true },
      { name: 'Two Towers (Due Torri)', url: 'https://www.duetorribologna.com/', desc: 'Climb Torre degli Asinelli (498 steps!) for panoramic views. The leaning Garisenda next door is Italy\'s other leaning tower.', star: true },
      { name: 'Piazza Maggiore', url: 'https://www.bolognawelcome.com/en/', desc: 'Grand main square with Basilica di San Petronio (5th largest church in the world!). Street performers, cafes.', star: true },
      { name: 'Porticoes Walk', url: 'https://www.bolognawelcome.com/en/', desc: '40km of covered arcades (UNESCO!) ‚Äî the longest in the world. Walk from Piazza Maggiore to the hilltop Sanctuary of San Luca.' },
      { name: 'FICO Eataly World', url: 'https://www.fico.it/en/', desc: 'World\'s largest food theme park ‚Äî watch pasta, cheese & chocolate being made. Rides + tastings! Kids LOVE it.' }
    ],
    hotels: [
      { name: 'Grand Hotel Majestic', url: 'https://www.grandhotelmajestic.duetorrihotels.com/', why: '5-star in 18th-century palazzo on Via Indipendenza. Frescoed ceilings, central location.', parking: 'Valet available', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', perk: 'Historic luxury, central' },
      { name: 'Art Hotel Orologio', url: 'https://www.art-hotel-orologio.it/en/', why: 'Boutique hotel facing Piazza Maggiore clock tower. Can\'t beat the location!', parking: 'Nearby garage', price: '‚Ç¨‚Ç¨‚Ç¨', perk: 'Best location in Bologna' },
      { name: 'Hotel Corona d\'Oro', url: 'https://www.hco.it/en/', why: 'Historic palace hotel on Via Oberdan. Art Nouveau details, elegant breakfast salon.', parking: 'Nearby public garage', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', perk: 'Art Nouveau charm, central' },
      { name: 'Hotel Touring', url: 'https://www.hoteltouring.it/', why: 'Great value near station. Modern, family rooms, easy parking nearby.', parking: 'Nearby parking', price: '‚Ç¨‚Ç¨', perk: 'Family-friendly, good value' }
    ],
    alternatives: [
      {
        city: 'Modena', emoji: 'üèéÔ∏è', driveFromPrev: '~1 hr from Verona',
        pitch: 'Ferrari & Lamborghini museums, world-famous balsamic vinegar, and Osteria Francescana (world\'s best restaurant). Petrolheads\' paradise!',
        whySwap: 'Ferrari Museum is a dream for car-loving kids. Balsamic vinegar tastings are fascinating. Modena cathedral is UNESCO. Smaller and more intimate than Bologna.',
        highlights: [
          { name: 'Museo Enzo Ferrari', desc: 'Stunning car museum under a yellow hood-shaped roof. Interactive exhibits, racing simulators ‚Äî kids go wild!' },
          { name: 'Acetaia (Balsamic Vinegar)', desc: 'Tour a traditional balsamic vinegar producer ‚Äî see barrels aging 25+ years. Taste the real thing (nothing like supermarket bottles!).' },
          { name: 'Piazza Grande', desc: 'UNESCO World Heritage square with the Romanesque Cathedral and Ghirlandina tower. Stunning at sunset.' }
        ],
        hotels: [
          { name: 'Best Western Premier Milano Palace Hotel', url: 'https://www.milanopalacehotel.it/en/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: '4-star near Piazza Grande. Elegant rooms, great breakfast, walkable to everything.' },
          { name: 'Hotel Cervetta 5', url: 'https://www.hotelcervetta5.it/en/', price: '‚Ç¨‚Ç¨', desc: 'Small boutique in the center. Modern, stylish, steps from the Cathedral. Great value.' }
        ],
        ztlNote: '‚ö†Ô∏è ZTL in center ‚Äî park at Parcheggio Novi Sad (large, near center) or hotel parking.'
      },
      {
        city: 'Parma', emoji: 'üßÄ', driveFromPrev: '~1.5 hrs from Verona',
        pitch: 'Parmigiano Reggiano AND Prosciutto di Parma ‚Äî both born here! UNESCO Creative City of Gastronomy. Gorgeous Romanesque architecture.',
        whySwap: 'The ultimate food pilgrimage ‚Äî visit actual Parmigiano dairies and prosciutto producers. Baptistery is one of Italy\'s most beautiful buildings. More relaxed than Bologna.',
        highlights: [
          { name: 'Parmigiano Reggiano Dairy Visit', desc: 'Watch wheels of Parmigiano being made ‚Äî early morning visits to working dairies. Fresh cheese tastings! Book ahead.' },
          { name: 'Baptistery of Parma', desc: 'Pink Verona marble octagon ‚Äî stunning inside and out. Medieval frescoes are breathtaking.' },
          { name: 'Prosciutto di Parma Trail', desc: 'Visit a prosciuttificio in Langhirano ‚Äî see thousands of hams aging on racks. Taste the difference!' }
        ],
        hotels: [
          { name: 'Grand Hotel de la Ville', url: 'https://www.grandhoteldelaville.it/en/', price: '‚Ç¨‚Ç¨‚Ç¨', desc: '4-star hotel near Piazza Garibaldi. Elegant, central, excellent restaurant with local specialties.' },
          { name: 'Hotel Button', url: 'https://www.hotelbutton.it/en/', price: '‚Ç¨‚Ç¨', desc: 'Charming 3-star in the center. Simple, clean, great breakfast with local products. Family-friendly.' }
        ],
        ztlNote: '‚ö†Ô∏è ZTL in center ‚Äî park at Parcheggio Goito (near center) or Toschi garage. Both walkable.'
      }
    ]
  },
  {
    day: 10, date: 'Apr 1', weekday: 'Tue', flag: 'üì¶', phase: 'italy',
    title: 'Buffer Day ‚Üí Florence Airport',
    am: 'Sleep in! Last Italian breakfast ‚Üí 1.5 hr drive to Florence airport area',
    pm: 'Relax at hotel, pool if available, pack up. Final Italian dinner ‚Äî no rush!',
    sleep: 'Florence Airport Hotel', sleepIcon: '‚úàÔ∏è',
    parking: '‚úÖ Airport hotel parking', parkingStatus: 'ok',
    ztl: '‚úÖ No ZTL near airport', ztlStatus: 'ok',
    familyTip: 'This is YOUR day. Let kids swim, do laundry, pack calmly. One last pizza. Set out tomorrow\'s travel clothes tonight! DON\'T drive into Florence city center with the car.',
    destinations: [],
    hotels: [
      { name: 'Hilton Garden Inn Florence Novoli', url: 'https://www.hilton.com/en/hotels/flrfigi-hilton-garden-inn-florence-novoli/', why: 'Modern, near airport. Tram to Florence center.', parking: 'Free self-parking', price: '‚Ç¨‚Ç¨', perk: 'Restaurant, tram to city' },
      { name: 'Villa Campestri Olive Oil Resort', url: 'https://www.villacampestri.com/en/', why: 'Final splurge! 5-star olive oil estate. Pool, spa, incredible breakfast.', parking: 'Free on-site', price: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨', perk: 'Pool, farm, stunning grounds' },
      { name: 'Starhotels Tuscany', url: 'https://www.starhotels.com/en/our-hotels/tuscany-florence/', why: '4-star, tram stop right in front ‚Äî direct to city center.', parking: 'Self-parking', price: '‚Ç¨‚Ç¨‚Ç¨', perk: 'Tram access, restaurant' },
      { name: 'Hotel Kraft', url: 'https://www.hotelkraft.it/en/', why: 'Elegant rooftop pool with Arno River views. Near Santa Maria Novella station.', parking: 'Garage available (~‚Ç¨30/night)', price: '‚Ç¨‚Ç¨‚Ç¨', perk: 'Rooftop pool, central location' },
      { name: 'Plaza Hotel Lucchesi', url: 'https://www.plazalucchesi.it/en/', why: 'Classic 4-star on the Arno with rooftop bar and panoramic views. Great for families.', parking: 'Garage available', price: '‚Ç¨‚Ç¨‚Ç¨', perk: 'River views, rooftop terrace' }
    ]
  },
  {
    day: 11, date: 'Apr 2', weekday: 'Wed', flag: '‚úàÔ∏è', phase: 'departure',
    title: 'Fly Home!',
    am: 'Early departure ‚Äî 6:30 AM flight. Return rental car at Florence Airport.',
    pm: '‚Äî',
    sleep: 'Home sweet home', sleepIcon: 'üè†',
    parking: '‚úÖ Return car at airport', parkingStatus: 'ok',
    ztl: '‚Äî', ztlStatus: 'ok',
    familyTip: 'Pack a small activity bag in carry-on for the flight. Download shows the night before. Airport snack haul is a fun tradition to start!',
    destinations: [],
    hotels: []
  }
];

const CATEGORIES = [
  { id: 'food', label: 'üçΩ Food', color: 'cat-food' },
  { id: 'hotel', label: 'üè® Hotel', color: 'cat-hotel' },
  { id: 'gas', label: '‚õΩ Gas', color: 'cat-gas' },
  { id: 'tickets', label: 'üé´ Tickets', color: 'cat-tickets' },
  { id: 'shopping', label: 'üõç Shopping', color: 'cat-shopping' },
  { id: 'parking', label: 'üöó Parking', color: 'cat-parking' },
  { id: 'flights', label: '‚úàÔ∏è Flights', color: 'cat-other' },
  { id: 'other', label: 'üì± Other', color: 'cat-other' }
];

const DEFAULT_PACKING = [
  { cat: 'üìÑ Documents & Money', items: [
    'Passports (all family members)',
    'Travel insurance docs (printed + digital)',
    'International driving permit',
    'Printed hotel confirmations (backup)',
    'Rental car reservation (Munich pickup ‚Üí Florence drop-off)',
    'Credit/debit cards ‚Äî notify bank of travel dates',
    'Cash ‚Äî some euros for tolls & small shops',
    'Copies of passports (separate from originals)'
  ]},
  { cat: 'üì± Tech & Electronics', items: [
    'Phone chargers + cables (USB-C / Lightning)',
    'Portable battery pack (charged!)',
    'EU power adapters (2x ‚Äî Type C/F)',
    'Car phone mount',
    'Camera + memory cards',
    'Kids\' tablets + headphones',
    'Download offline Google Maps (Austria + Italy)',
    'Download movies/shows for Day 5 big drive',
    'AirTags / Tile trackers for luggage'
  ]},
  { cat: 'üëï Clothing', items: [
    'Comfortable walking shoes (everyone)',
    'Rain jackets (March weather!)',
    'Layers ‚Äî Austria mountains are cold!',
    'Sunglasses',
    'Hats / sun protection',
    'Swimsuits ‚Äî Das Edelweiss waterpark + hotel pools',
    'One nice outfit for dinners',
    'Pajamas',
    'Socks & underwear (11 days worth)'
  ]},
  { cat: 'üß¥ Toiletries & Health', items: [
    'Sunscreen',
    'Toothbrushes & toothpaste',
    'Prescription medications',
    'Kids\' medicine (Tylenol, Benadryl, band-aids)',
    'Motion sickness remedies (for mountain roads)',
    'Hand sanitizer',
    'Lip balm (dry alpine air)',
    'Travel-size shampoo / body wash'
  ]},
  { cat: 'üë∂ Kids Essentials', items: [
    'Comfort items (stuffed animals, blankets)',
    'Activity bag for flights ‚Äî coloring books, stickers',
    'Snacks for Day 5 big drive',
    'Reusable water bottles (everyone)',
    'Small backpack for each kid (day trips)',
    'Card games / travel games',
    'Favorite snacks from home'
  ]},
  { cat: 'üöó Car & Road Trip', items: [
    'Buy Austria Vignette (motorway sticker) online',
    'Snacks & water for car',
    'Trash bags for car',
    'Paper towels / wet wipes',
    'Neck pillows for kids',
    'USB car charger',
    'Printed ZTL rules for Italy'
  ]},
  { cat: 'üìã Pre-Trip To-Do', items: [
    'Book Salzburg hotel',
    'Book Val d\'Orcia hotel',
    'Book Verona hotel',
    'Book Florence airport hotel',
    'Reserve rental car',
    'Notify bank of travel dates',
    'Check Arena di Verona hours',
    'Confirm Das Edelweiss reservation',
    'Set GPS to avoid city centers in Italy',
    'Save Parcheggio Cittadella (Verona) in Maps'
  ]}
];

const DEFAULT_CHECKLISTS = {
  pretip: {
    title: 'üìã Pre-Trip To-Do',
    items: [
      { text: 'Book Salzburg hotel', checked: false },
      { text: 'Book Val d\'Orcia hotel', checked: false },
      { text: 'Book Verona hotel', checked: false },
      { text: 'Book Florence airport hotel', checked: false },
      { text: 'Reserve rental car (Munich pickup ‚Üí Florence drop-off)', checked: false },
      { text: 'Buy Austria Vignette (motorway sticker) online', checked: false },
      { text: 'Download offline maps', checked: false },
      { text: 'Notify bank of travel dates', checked: false },
      { text: 'Check Arena di Verona hours (March closures?)', checked: false },
      { text: 'Pack kids\' entertainment for flights + drives', checked: false },
      { text: 'Confirm Das Edelweiss reservation', checked: false }
    ]
  },
  ztl: {
    title: 'üáÆüáπ ZTL Survival Checklist',
    items: [
      { text: 'Read ZTL rules before entering Italy', checked: false },
      { text: 'Download ZTL map for Florence', checked: false },
      { text: 'Confirm Verona hotel is OUTSIDE ZTL', checked: false },
      { text: 'Confirm Florence hotel is OUTSIDE ZTL', checked: false },
      { text: 'Set GPS to "avoid city centers" in Italy', checked: false },
      { text: 'Save Parcheggio Cittadella (Verona) address in Maps', checked: false },
      { text: 'DO NOT follow GPS into walled Tuscan towns', checked: false }
    ]
  }
};

const DEFAULT_NOTE = {
  id: 'default-1',
  text: '‚úàÔ∏è Trip starts Mar 23! Don\'t forget to download offline maps for Austria & Italy.',
  day: 'general',
  timestamp: new Date('2026-02-25T10:00:00').toISOString()
};

// ============================================================
// STATE MANAGEMENT
// ============================================================
const STORAGE_KEY = 'TRIP_HUB_DATA';
let state = null;
let saveTimeout = null;

function getDefaultState() {
  return {
    version: 1,
    darkMode: true,
    notes: [{ ...DEFAULT_NOTE }],
    checklists: JSON.parse(JSON.stringify(DEFAULT_CHECKLISTS)),
    expenses: [],
    expandedDays: [],
    activeTab: 'today',
    activeNotesTab: 'journal',
    budget: 15000,
    fontSize: 0,
    packingList: initPackingList()
  };
}

function loadState() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) {
      state = JSON.parse(raw);
      // Ensure all keys exist (merge with defaults)
      const def = getDefaultState();
      if (!state.notes) state.notes = def.notes;
      if (!state.checklists) state.checklists = def.checklists;
      if (!state.expenses) state.expenses = def.expenses;
      if (!state.expandedDays) state.expandedDays = def.expandedDays;
      if (state.activeTab === undefined) state.activeTab = 'today';
      if (state.activeNotesTab === undefined) state.activeNotesTab = 'journal';
      if (state.budget === undefined) state.budget = 15000;
      if (state.fontSize === undefined) state.fontSize = 0;
      if (!state.packingList) state.packingList = initPackingList();
    } else {
      state = getDefaultState();
    }
  } catch (e) {
    state = getDefaultState();
  }
}

function saveState() {
  clearTimeout(saveTimeout);
  saveTimeout = setTimeout(() => {
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    } catch (e) { /* quota exceeded fallback */ }
  }, 200);
}

// ============================================================
// UTILITIES
// ============================================================
function getTripDay() {
  const now = new Date();
  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  const start = new Date(TRIP_START);
  const diff = Math.floor((today - start) / (1000 * 60 * 60 * 24));
  if (diff < 0) return { dayNum: 1, status: 'before', daysUntil: Math.abs(diff) };
  if (diff > 10) return { dayNum: 11, status: 'after' };
  return { dayNum: diff + 1, status: 'during' };
}

function phaseColor(phase) {
  const map = { austria: '#0d9488', transition: '#d97706', italy: '#c2410c', departure: '#475569' };
  return map[phase] || '#475569';
}

function phaseBg(phase) {
  return `phase-${phase}`;
}

function phaseBgLight(phase) {
  return `phase-${phase}-light`;
}

function genId() {
  return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
}

function formatTimestamp(iso) {
  const d = new Date(iso);
  return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' });
}

function escHtml(str) {
  const d = document.createElement('div');
  d.textContent = str;
  return d.innerHTML;
}

function mapsUrl(name) {
  return 'https://www.google.com/maps/dir/?api=1&destination=' + encodeURIComponent(name);
}

function renderAlternatives(d) {
  if (!d.alternatives || d.alternatives.length === 0) return '';
  return `<div class="alt-explorer rounded-2xl p-4 mt-4">
    <button onclick="this.nextElementSibling.classList.toggle('hidden');this.querySelector('.chevron').classList.toggle('open')" class="tap flex items-center justify-between w-full text-left">
      <div class="flex items-center gap-2">
        <span class="alt-badge">‚ú® NEW</span>
        <span class="font-heading font-700 text-sm">Explore Alternative Cities</span>
      </div>
      <span class="chevron text-sm text-gray-400">‚ñº</span>
    </button>
    <div class="hidden mt-3">
      <p class="text-xs text-gray-500 dark:text-gray-400 mb-3">Instead of the planned route, consider these alternative bases for your Tuscany days:</p>
      <div class="space-y-3">${d.alternatives.map((alt, i) => `
        <div class="alt-city-card rounded-xl overflow-hidden" id="alt-${d.day}-${i}">
          <button onclick="toggleAltCity(${d.day}, ${i})" class="tap w-full text-left p-3">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-2">
                <span class="text-2xl">${alt.emoji}</span>
                <div>
                  <p class="font-heading font-700 text-sm">${escHtml(alt.city)}</p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">${escHtml(alt.driveFromPrev)}</p>
                </div>
              </div>
              <span class="chevron text-xs text-gray-400" id="altChev-${d.day}-${i}">‚ñº</span>
            </div>
            <p class="text-xs mt-2 leading-relaxed">${escHtml(alt.pitch)}</p>
          </button>
          <div class="hidden px-3 pb-3" id="altBody-${d.day}-${i}">
            <div class="bg-orange-50 dark:bg-orange-900/20 rounded-lg p-2.5 mb-3">
              <p class="text-xs font-600 text-orange-800 dark:text-orange-300">üí° Why swap? ${escHtml(alt.whySwap)}</p>
            </div>
            <p class="font-heading font-600 text-xs mb-2">üèõ Highlights</p>
            <div class="space-y-2 mb-3">${alt.highlights.map(h => `<div class="glass rounded-lg p-2.5">
              <p class="font-heading font-600 text-xs">${escHtml(h.name)}</p>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">${escHtml(h.desc)}</p>
            </div>`).join('')}</div>
            ${alt.hotels.length > 0 ? `<p class="font-heading font-600 text-xs mb-2">üè® Where to Stay</p>
            <div class="space-y-2 mb-3">${alt.hotels.map(h => `<div class="glass rounded-lg p-2.5">
              <div class="flex justify-between items-start">
                <p class="font-heading font-600 text-xs">${escHtml(h.name)}</p>
                <span class="text-xs text-amber-600 dark:text-amber-400 font-600 ml-2">${h.price}</span>
              </div>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">${escHtml(h.desc)}</p>
              <a href="${h.url}" target="_blank" rel="noopener noreferrer" class="inline-block mt-1 text-xs font-600 text-teal-600 dark:text-teal-400">View ‚Üí</a>
            </div>`).join('')}</div>` : ''}
            <div class="rounded-lg p-2.5 text-xs ${alt.ztlNote.startsWith('‚úÖ') ? 'bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-300' : alt.ztlNote.startsWith('üî¥') ? 'bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-300' : 'bg-amber-50 dark:bg-amber-900/20 text-amber-800 dark:text-amber-300'}">
              üöó ${escHtml(alt.ztlNote)}
            </div>
          </div>
        </div>`).join('')}
      </div>
    </div>
  </div>`;
}

function toggleAltCity(day, idx) {
  const body = document.getElementById('altBody-' + day + '-' + idx);
  const card = document.getElementById('alt-' + day + '-' + idx);
  const chev = document.getElementById('altChev-' + day + '-' + idx);
  if (body) {
    body.classList.toggle('hidden');
    card.classList.toggle('expanded');
    chev.classList.toggle('open');
  }
}

// ============================================================
// RENDER: MIDWAY STOPS (for day cards)
// ============================================================
function renderMidwayStops(d) {
  if (!d.midwayStops || d.midwayStops.length === 0) return '';
  return `<div class="alt-explorer rounded-2xl p-4 mt-4" style="border-color:rgba(217,119,6,0.3);background:linear-gradient(135deg,rgba(254,243,199,0.4),rgba(253,230,138,0.2))">
    <button onclick="this.nextElementSibling.classList.toggle('hidden');this.querySelector('.chevron').classList.toggle('open')" class="tap flex items-center justify-between w-full text-left">
      <div class="flex items-center gap-2">
        <span class="alt-badge" style="background:linear-gradient(135deg,#d97706,#92400e)">üõë OPTION</span>
        <span class="font-heading font-700 text-sm">Break Up the Drive ‚Äî Overnight Stop</span>
      </div>
      <span class="chevron text-sm text-gray-400">‚ñº</span>
    </button>
    <div class="hidden mt-3">
      <p class="text-xs text-gray-500 dark:text-gray-400 mb-3">Instead of driving straight through, consider an overnight at one of these worthwhile stops:</p>
      <div class="space-y-3">${d.midwayStops.map((stop, i) => `
        <div class="alt-city-card rounded-xl overflow-hidden" style="border-color:rgba(217,119,6,0.2)" id="midway-${d.day}-${i}">
          <button onclick="toggleMidway(${d.day}, ${i})" class="tap w-full text-left p-3">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-2">
                <span class="text-2xl">${stop.emoji}</span>
                <div>
                  <p class="font-heading font-700 text-sm">${escHtml(stop.city)}</p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">${escHtml(stop.driveFromPrev)} ¬∑ then ${escHtml(stop.driveToNext)}</p>
                </div>
              </div>
              <span class="chevron text-xs text-gray-400" id="midwayChev-${d.day}-${i}">‚ñº</span>
            </div>
            <p class="text-xs mt-2 leading-relaxed">${escHtml(stop.pitch)}</p>
          </button>
          <div class="hidden px-3 pb-3" id="midwayBody-${d.day}-${i}">
            <div class="bg-amber-50 dark:bg-amber-900/20 rounded-lg p-2.5 mb-3">
              <p class="text-xs font-600 text-amber-800 dark:text-amber-300">üí° Why stop? ${escHtml(stop.whyStop)}</p>
            </div>
            <p class="font-heading font-600 text-xs mb-2">üèõ Highlights</p>
            <div class="space-y-2 mb-3">${stop.highlights.map(h => `<div class="glass rounded-lg p-2.5">
              <p class="font-heading font-600 text-xs">${escHtml(h.name)}</p>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">${escHtml(h.desc)}</p>
            </div>`).join('')}</div>
            ${stop.hotels && stop.hotels.length > 0 ? `<p class="font-heading font-600 text-xs mb-2">üè® Where to Stay</p>
            <div class="space-y-2 mb-3">${stop.hotels.map(h => `<div class="glass rounded-lg p-2.5">
              <div class="flex justify-between items-start">
                <p class="font-heading font-600 text-xs">${escHtml(h.name)}</p>
                <span class="text-xs text-amber-600 dark:text-amber-400 font-600 ml-2">${h.price}</span>
              </div>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">${escHtml(h.desc)}</p>
              <div class="flex gap-3 mt-1">
                <a href="${h.url}" target="_blank" rel="noopener noreferrer" class="text-xs font-600 text-teal-600 dark:text-teal-400">View ‚Üí</a>
                <a href="${mapsUrl(h.name)}" target="_blank" rel="noopener noreferrer" class="text-xs font-600 text-blue-600 dark:text-blue-400">üìç Map</a>
              </div>
            </div>`).join('')}</div>` : ''}
            <div class="rounded-lg p-2.5 text-xs ${stop.ztlNote.startsWith('‚úÖ') ? 'bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-300' : stop.ztlNote.startsWith('üî¥') ? 'bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-300' : 'bg-amber-50 dark:bg-amber-900/20 text-amber-800 dark:text-amber-300'}">
              üöó ${escHtml(stop.ztlNote)}
            </div>
          </div>
        </div>`).join('')}
      </div>
    </div>
  </div>`;
}

function toggleMidway(day, idx) {
  const body = document.getElementById('midwayBody-' + day + '-' + idx);
  const card = document.getElementById('midway-' + day + '-' + idx);
  const chev = document.getElementById('midwayChev-' + day + '-' + idx);
  if (body) {
    body.classList.toggle('hidden');
    card.classList.toggle('expanded');
    chev.classList.toggle('open');
  }
}

// ============================================================
// RENDER: HOTELS TAB
// ============================================================
function renderHotelCard(h, isMain) {
  if (isMain) {
    return `<div class="glass rounded-xl p-3 hover:shadow-md transition">
      <div class="flex justify-between items-start mb-1">
        <p class="font-heading font-600 text-sm">${escHtml(h.name)}</p>
        <span class="text-xs text-amber-600 dark:text-amber-400 font-600 flex-shrink-0 ml-2">${h.price}</span>
      </div>
      <p class="text-xs text-gray-500 dark:text-gray-400">${escHtml(h.why)}</p>
      <div class="flex flex-wrap gap-2 mt-2 text-xs">
        <span class="px-2 py-0.5 bg-blue-50 dark:bg-blue-900/30 rounded-full">üöó ${escHtml(h.parking)}</span>
        <span class="px-2 py-0.5 bg-pink-50 dark:bg-pink-900/30 rounded-full">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ${escHtml(h.perk)}</span>
      </div>
      <div class="flex gap-3 mt-2">
        <a href="${h.url}" target="_blank" rel="noopener noreferrer" class="text-xs font-600 text-teal-600 dark:text-teal-400 tap">View ‚Üí</a>
        <a href="${mapsUrl(h.name)}" target="_blank" rel="noopener noreferrer" class="text-xs font-600 text-blue-600 dark:text-blue-400 tap">üìç Navigate</a>
      </div>
    </div>`;
  }
  return `<div class="glass rounded-xl p-3 hover:shadow-md transition">
    <div class="flex justify-between items-start mb-1">
      <p class="font-heading font-600 text-sm">${escHtml(h.name)}</p>
      <span class="text-xs text-amber-600 dark:text-amber-400 font-600 flex-shrink-0 ml-2">${h.price}</span>
    </div>
    <p class="text-xs text-gray-500 dark:text-gray-400">${escHtml(h.desc)}</p>
    <div class="flex gap-3 mt-2">
      <a href="${h.url}" target="_blank" rel="noopener noreferrer" class="text-xs font-600 text-teal-600 dark:text-teal-400 tap">View ‚Üí</a>
      <a href="${mapsUrl(h.name)}" target="_blank" rel="noopener noreferrer" class="text-xs font-600 text-blue-600 dark:text-blue-400 tap">üìç Navigate</a>
    </div>
  </div>`;
}

function renderHotels() {
  const container = document.getElementById('hotelsContent');
  let html = `<div class="mb-6">
    <h1 class="font-heading font-800 text-2xl mb-1">üè® Hotels by Destination</h1>
    <p class="text-sm text-gray-500 dark:text-gray-400">All accommodation options organized by day and city</p>
  </div>`;

  // Track which sleep locations we've already shown to avoid duplicates
  let lastSleep = '';
  DAYS.forEach(d => {
    const hasMainHotels = d.hotels && d.hotels.length > 0;
    const hasAltHotels = d.alternatives && d.alternatives.some(a => a.hotels && a.hotels.length > 0);
    const hasMidwayHotels = d.midwayStops && d.midwayStops.some(m => m.hotels && m.hotels.length > 0);

    // Skip days with no hotel content at all
    if (!hasMainHotels && !hasAltHotels && !hasMidwayHotels) {
      // Show a small reference for days staying at same place
      if (d.sleep !== 'Home sweet home') {
        html += `<div class="mb-4 opacity-60">
          <div class="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400">
            <span>${d.flag}</span>
            <span class="font-heading font-600">Day ${d.day}</span>
            <span>¬∑</span>
            <span>üõè ${escHtml(d.sleep)} ${d.sleepIcon}</span>
          </div>
        </div>`;
      }
      lastSleep = d.sleep;
      return;
    }

    // Section header
    html += `<div class="mb-6">
      <div class="${phaseBg(d.phase)} text-white rounded-xl p-3 mb-3">
        <div class="flex items-center gap-3">
          <span class="text-2xl">${d.sleepIcon}</span>
          <div>
            <p class="font-heading font-700 text-lg">Day ${d.day} ‚Äî ${escHtml(d.sleep)}</p>
            <p class="text-xs opacity-80">${d.date} (${d.weekday}) ¬∑ ${escHtml(d.title)}</p>
          </div>
        </div>
      </div>`;

    // Main hotels
    if (hasMainHotels) {
      html += `<div class="hotel-grid mb-4" style="gap:0.75rem">${d.hotels.map(h => renderHotelCard(h, true)).join('')}</div>`;
    }

    // Midway stop hotels
    if (hasMidwayHotels) {
      html += `<div class="mb-4">
        <div class="flex items-center gap-2 mb-3">
          <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-600" style="background:linear-gradient(135deg,#d97706,#92400e);color:white">üõë Midway Stops</span>
          <span class="text-xs text-gray-500 dark:text-gray-400">Break up the big drive</span>
        </div>`;
      d.midwayStops.forEach(m => {
        if (!m.hotels || m.hotels.length === 0) return;
        html += `<div class="mb-4 pl-3 border-l-2 border-amber-300 dark:border-amber-700">
          <p class="font-heading font-600 text-sm mb-1">${m.emoji} ${escHtml(m.city)}</p>
          <p class="text-xs text-gray-500 dark:text-gray-400 mb-2">${escHtml(m.driveFromPrev)} ¬∑ then ${escHtml(m.driveToNext)}</p>
          <div class="hotel-grid" style="gap:0.5rem">${m.hotels.map(h => renderHotelCard(h, false)).join('')}</div>
        </div>`;
      });
      html += `</div>`;
    }

    // Alternative city hotels
    if (hasAltHotels) {
      html += `<div class="mb-4">
        <div class="flex items-center gap-2 mb-3">
          <span class="alt-badge">‚ú® Alternatives</span>
          <span class="text-xs text-gray-500 dark:text-gray-400">Other cities to consider</span>
        </div>`;
      d.alternatives.forEach(a => {
        if (!a.hotels || a.hotels.length === 0) return;
        html += `<div class="mb-4 pl-3 border-l-2 border-orange-300 dark:border-orange-700">
          <p class="font-heading font-600 text-sm mb-1">${a.emoji} ${escHtml(a.city)}</p>
          <p class="text-xs text-gray-500 dark:text-gray-400 mb-2">${escHtml(a.driveFromPrev || '')}</p>
          <div class="hotel-grid" style="gap:0.5rem">${a.hotels.map(h => renderHotelCard(h, false)).join('')}</div>
        </div>`;
      });
      html += `</div>`;
    }

    html += `</div>`; // close section
    lastSleep = d.sleep;
  });

  // Total count
  let totalHotels = 0;
  DAYS.forEach(d => {
    totalHotels += (d.hotels ? d.hotels.length : 0);
    if (d.alternatives) d.alternatives.forEach(a => totalHotels += (a.hotels ? a.hotels.length : 0));
    if (d.midwayStops) d.midwayStops.forEach(m => totalHotels += (m.hotels ? m.hotels.length : 0));
  });

  html += `<div class="text-center text-xs text-gray-400 dark:text-gray-500 mt-8 mb-4">
    ${totalHotels} hotel options across all destinations
  </div>`;

  container.innerHTML = html;
}

// ============================================================
// DARK MODE
// ============================================================
function applyDarkMode() {
  if (state.darkMode) {
    document.documentElement.classList.add('dark');
    document.body.classList.add('dark');
    document.body.classList.remove('bg-gray-50');
    document.body.classList.add('bg-gray-900');
  } else {
    document.documentElement.classList.remove('dark');
    document.body.classList.remove('dark');
    document.body.classList.remove('bg-gray-900');
    document.body.classList.add('bg-gray-50');
  }
  const icon = document.getElementById('darkIconHeader');
  if (icon) icon.textContent = state.darkMode ? '‚òÄÔ∏è' : 'üåô';
}

function toggleDarkMode() {
  state.darkMode = !state.darkMode;
  applyDarkMode();
  saveState();
  renderSettings();
}

// ============================================================
// FONT SIZE
// ============================================================
const FONT_SIZES = [
  { level: 0, scale: 100, label: 'A', desc: 'Default' },
  { level: 1, scale: 115, label: 'A+', desc: 'Large' },
  { level: 2, scale: 130, label: 'A++', desc: 'Extra Large' }
];

function applyFontSize() {
  const idx = state.fontSize || 0;
  const size = FONT_SIZES[idx] || FONT_SIZES[0];
  document.documentElement.style.fontSize = size.scale + '%';
  const icon = document.getElementById('fontSizeIcon');
  if (icon) icon.textContent = size.label;
}

function cycleFontSize() {
  state.fontSize = ((state.fontSize || 0) + 1) % FONT_SIZES.length;
  applyFontSize();
  saveState();
  renderSettings();
}

// ============================================================
// TAB SWITCHING
// ============================================================
function isDesktop() {
  return window.innerWidth >= 768;
}

function switchTab(tab) {
  state.activeTab = tab;
  saveState();
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.getElementById('tab-' + tab).classList.add('active');
  // Mobile bottom bar
  document.querySelectorAll('.tab-btn').forEach(b => {
    const isActive = b.dataset.tab === tab;
    b.classList.toggle('bg-teal-50', isActive && !state.darkMode);
    b.classList.toggle('dark:bg-teal-900', isActive && state.darkMode);
    b.style.color = isActive ? phaseColor('austria') : '';
    b.style.fontWeight = isActive ? '700' : '500';
  });
  // Desktop sidebar
  document.querySelectorAll('.desktop-tab-btn').forEach(b => {
    const isActive = b.dataset.tab === tab;
    if (isActive) {
      b.style.background = state.darkMode ? 'rgba(13,148,136,0.15)' : 'rgba(13,148,136,0.1)';
      b.style.color = phaseColor('austria');
    } else {
      b.style.background = '';
      b.style.color = '';
    }
  });
  if (tab === 'today') renderToday();
  if (tab === 'days') renderDays();
  if (tab === 'hotels') renderHotels();
  if (tab === 'packing') renderPacking();
  if (tab === 'notes') renderNotes();
  if (tab === 'settings') renderSettings();
}

// ============================================================
// NOTES TAB SWITCHING
// ============================================================
function switchNotesTab(sub) {
  state.activeNotesTab = sub;
  saveState();
  document.querySelectorAll('.notes-section').forEach(s => s.classList.add('hidden'));
  document.getElementById('notes-' + sub).classList.remove('hidden');
  document.querySelectorAll('.notes-pill').forEach(p => {
    const isActive = p.dataset.pill === sub;
    if (isActive) {
      p.classList.add('bg-teal-600', 'text-white');
      p.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
    } else {
      p.classList.remove('bg-teal-600', 'text-white');
      p.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
    }
  });
}

// ============================================================
// RENDER: TODAY
// ============================================================
function renderToday() {
  const trip = getTripDay();
  const dayData = DAYS[trip.dayNum - 1];
  const container = document.getElementById('todayContent');
  let countdownHtml = '';
  if (trip.status === 'before') {
    countdownHtml = `<div class="glass rounded-2xl p-4 mb-4 text-center anim-fade">
      <div class="anim-float text-4xl mb-2">üèî ‚Üí üåª ‚Üí üèõ ‚Üí ‚úàÔ∏è</div>
      <p class="font-heading font-700 text-2xl">${trip.daysUntil} days to go!</p>
      <p class="text-sm text-gray-500 dark:text-gray-400">Mar 23 ‚Äì Apr 2 ¬∑ 11 Days ¬∑ 5 Hotels ¬∑ 2 Countries</p>
    </div>`;
  } else if (trip.status === 'after') {
    countdownHtml = `<div class="glass rounded-2xl p-4 mb-4 text-center anim-fade">
      <div class="text-4xl mb-2">üè†</div>
      <p class="font-heading font-700 text-2xl">Trip Complete!</p>
      <p class="text-sm text-gray-500 dark:text-gray-400">What an incredible adventure.</p>
    </div>`;
  }

  container.innerHTML = countdownHtml + renderDayCardFull(dayData, true);
}

// ============================================================
// RENDER: FULL DAY CARD (for Today tab)
// ============================================================
function renderDayCardFull(d, isToday) {
  const ztlBanner = (d.phase === 'italy' || d.phase === 'transition') && d.ztlStatus === 'warn'
    ? `<div class="ztl-banner rounded-xl p-3 mb-3"><p class="font-heading font-600 text-sm">üö¶ ZTL Warning: ${escHtml(d.ztl)}</p></div>` : '';

  const driveRouteHtml = d.driveRoute ? `<div class="bg-amber-50 dark:bg-amber-900/30 rounded-xl p-3 mb-3">
    <p class="font-heading font-600 text-sm mb-2">üöó Drive Route</p>
    <ul class="text-sm space-y-1">${d.driveRoute.map(r => `<li class="flex gap-2"><span class="text-amber-500">‚Üí</span><span>${escHtml(r)}</span></li>`).join('')}</ul>
  </div>` : '';

  const parkingStrategyHtml = d.parkingStrategy ? `<div class="bg-blue-50 dark:bg-blue-900/30 rounded-xl p-3 mb-3">
    <p class="font-heading font-600 text-sm">üÖøÔ∏è Parking Strategy</p>
    <p class="text-sm mt-1">${escHtml(d.parkingStrategy)}</p>
  </div>` : '';

  const destsHtml = d.destinations && d.destinations.length > 0
    ? `<div class="mb-3"><p class="font-heading font-600 text-sm mb-2">üìç Destinations</p>
      <div class="dest-grid" style="gap:0.5rem">${d.destinations.map(dest => `<div class="glass rounded-xl p-3 hover:shadow-md transition">
        <div class="flex items-start gap-2">
          ${dest.star ? '<span class="text-amber-400 text-sm flex-shrink-0">‚≠ê</span>' : '<span class="text-gray-400 text-sm flex-shrink-0">üìç</span>'}
          <div class="flex-1 min-w-0"><p class="font-heading font-600 text-sm">${escHtml(dest.name)}</p><p class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">${escHtml(dest.desc)}</p>
            <div class="flex gap-3 mt-2">
              <a href="${dest.url}" target="_blank" rel="noopener noreferrer" class="text-xs font-600 text-teal-600 dark:text-teal-400 tap">Info ‚Üí</a>
              <a href="${mapsUrl(dest.name)}" target="_blank" rel="noopener noreferrer" class="text-xs font-600 text-blue-600 dark:text-blue-400 tap">üìç Navigate</a>
            </div>
          </div>
        </div>
      </div>`).join('')}</div></div>` : '';

  // Today's Notes + Expenses
  const todayNotesHtml = isToday ? `<div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
    <p class="font-heading font-600 text-sm mb-2">üìù Today's Notes</p>
    <textarea id="todayNoteArea" class="w-full rounded-xl border border-gray-200 dark:border-gray-700 p-3 text-sm resize-none h-24 focus:ring-2 focus:ring-teal-400 outline-none" placeholder="Jot down a note for today..." oninput="saveTodayNote(${d.day}, this.value)">${escHtml(getTodayNote(d.day))}</textarea>
  </div>
  <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
    <div id="dayExpenses-${d.day}">${renderDayExpenses(d.day)}</div>
  </div>` : '';

  return `<div class="rounded-2xl overflow-hidden shadow-lg anim-fade mb-4">
    <div class="${phaseBg(d.phase)} text-white p-4">
      <div class="flex justify-between items-start">
        <div>
          <p class="text-xs opacity-80 font-body">${d.date} (${d.weekday})</p>
          <h2 class="font-heading font-700 text-xl mt-1">${d.flag} Day ${d.day} ‚Äî ${escHtml(d.title)}</h2>
        </div>
        <span class="text-3xl">${d.sleepIcon}</span>
      </div>
    </div>
    <div class="bg-white dark:bg-gray-800 p-4">
      <div class="day-ampm grid grid-cols-1 gap-2 mb-3">
        <div class="flex gap-2 items-start"><span class="text-amber-400 flex-shrink-0">‚òÄÔ∏è</span><p class="text-sm"><strong>AM:</strong> ${escHtml(d.am)}</p></div>
        <div class="flex gap-2 items-start"><span class="flex-shrink-0">üåô</span><p class="text-sm"><strong>PM:</strong> ${escHtml(d.pm)}</p></div>
      </div>
      <div class="flex flex-wrap gap-2 mb-3 text-xs">
        <span class="px-2 py-1 rounded-full ${d.sleepIcon === 'üè†' ? 'bg-gray-100 dark:bg-gray-700' : 'bg-indigo-50 dark:bg-indigo-900/30'}">üõè ${escHtml(d.sleep)} ${d.sleepIcon}</span>
        <span class="px-2 py-1 rounded-full ${d.parkingStatus === 'warn' ? 'bg-amber-50 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300' : 'bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-300'}">${escHtml(d.parking)}</span>
        ${d.ztl !== '‚Äî' ? `<span class="px-2 py-1 rounded-full ${d.ztlStatus === 'warn' ? 'bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300' : 'bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-300'}">${escHtml(d.ztl)}</span>` : ''}
      </div>
      ${ztlBanner}
      <div class="family-tip rounded-xl p-3 mb-3">
        <p class="font-heading font-600 text-sm mb-1">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Tip</p>
        <p class="text-sm">${escHtml(d.familyTip)}</p>
      </div>
      ${driveRouteHtml}
      ${parkingStrategyHtml}
      ${destsHtml}
      ${renderMidwayStops(d)}
      ${renderAlternatives(d)}
      <div class="mt-3 text-center">
        <button onclick="switchTab('hotels')" class="inline-flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-heading font-600 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 hover:bg-indigo-100 dark:hover:bg-indigo-900/50 transition tap">üè® View Hotels for This Day ‚Üí</button>
      </div>
      ${todayNotesHtml}
    </div>
  </div>`;
}

function getTodayNote(dayNum) {
  const note = state.notes.find(n => n.day === dayNum && n.id && n.id.startsWith('today-'));
  return note ? note.text : '';
}

function saveTodayNote(dayNum, text) {
  const existingIdx = state.notes.findIndex(n => n.day === dayNum && n.id && n.id.startsWith('today-'));
  if (existingIdx >= 0) {
    if (text.trim() === '') {
      state.notes.splice(existingIdx, 1);
    } else {
      state.notes[existingIdx].text = text;
      state.notes[existingIdx].timestamp = new Date().toISOString();
    }
  } else if (text.trim() !== '') {
    state.notes.push({ id: 'today-' + dayNum, text, day: dayNum, timestamp: new Date().toISOString() });
  }
  saveState();
}

// ============================================================
// RENDER: PACKING LIST
// ============================================================
function initPackingList() {
  return DEFAULT_PACKING.map(cat => ({
    cat: cat.cat,
    items: cat.items.map(text => ({ text, checked: false })),
    customItems: []
  }));
}

function renderPacking() {
  const el = document.getElementById('packingContent');
  const list = state.packingList;
  const totalItems = list.reduce((s, c) => s + c.items.length + c.customItems.length, 0);
  const checkedItems = list.reduce((s, c) => s + c.items.filter(i => i.checked).length + c.customItems.filter(i => i.checked).length, 0);
  const pct = totalItems > 0 ? Math.round((checkedItems / totalItems) * 100) : 0;
  const allDone = pct === 100;

  el.innerHTML = `
    <div class="flex justify-between items-center mb-2">
      <h2 class="font-heading font-700 text-xl">üß≥ Packing List</h2>
      <span class="text-sm font-heading font-600 ${allDone ? 'text-green-600 dark:text-green-400' : 'text-gray-500 dark:text-gray-400'}">${checkedItems}/${totalItems}</span>
    </div>
    <div class="progress-track mb-4"><div class="progress-fill ${allDone ? 'bg-green-500' : 'bg-teal-500'}" style="width:${pct}%"></div></div>
    ${allDone ? '<div class="text-center py-3 mb-4 bg-green-50 dark:bg-green-900/20 rounded-xl"><p class="font-heading font-700 text-green-600 dark:text-green-400">All packed! Ready to go!</p></div>' : ''}
    <div class="space-y-4">
      ${list.map((cat, ci) => renderPackingCategory(cat, ci)).join('')}
    </div>
    <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700 flex gap-3">
      <button onclick="uncheckAllPacking()" class="tap flex-1 py-3 rounded-xl border border-gray-200 dark:border-gray-700 font-heading font-600 text-sm transition hover:bg-gray-100 dark:hover:bg-gray-800">Uncheck All</button>
      <button onclick="resetPacking()" class="tap flex-1 py-3 rounded-xl bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400 font-heading font-600 text-sm transition hover:bg-red-100 dark:hover:bg-red-900/50">Reset List</button>
    </div>`;
}

function renderPackingCategory(cat, ci) {
  const allItems = [...cat.items, ...cat.customItems];
  const checked = allItems.filter(i => i.checked).length;
  const total = allItems.length;
  const pct = total > 0 ? Math.round((checked / total) * 100) : 0;
  const isDone = checked === total && total > 0;

  return `<div class="glass rounded-2xl overflow-hidden">
    <button onclick="togglePackingCat(${ci})" class="w-full tap flex items-center justify-between p-4 text-left">
      <div class="flex items-center gap-2">
        <span class="font-heading font-700 text-sm ${isDone ? 'line-through text-gray-400' : ''}">${escHtml(cat.cat)}</span>
        ${isDone ? '<span class="text-green-500 text-xs">‚úÖ</span>' : ''}
      </div>
      <div class="flex items-center gap-2">
        <span class="text-xs text-gray-400">${checked}/${total}</span>
        <span class="chevron text-xs text-gray-400" id="packChev-${ci}">‚ñº</span>
      </div>
    </button>
    <div id="packBody-${ci}" class="px-4 pb-4 hidden">
      <div class="progress-track mb-3"><div class="progress-fill ${isDone ? 'bg-green-500' : 'bg-teal-500'}" style="width:${pct}%"></div></div>
      <div class="space-y-1.5">
        ${cat.items.map((item, ii) => `<div class="flex items-center gap-3 tap py-1" onclick="togglePackingItem(${ci},${ii},'items')">
          <div class="check-box ${item.checked ? 'checked' : ''}"></div>
          <span class="text-sm ${item.checked ? 'line-through text-gray-400' : ''} flex-1">${escHtml(item.text)}</span>
        </div>`).join('')}
        ${cat.customItems.map((item, ii) => `<div class="flex items-center gap-3 tap py-1" onclick="togglePackingItem(${ci},${ii},'customItems')">
          <div class="check-box ${item.checked ? 'checked' : ''}"></div>
          <span class="text-sm ${item.checked ? 'line-through text-gray-400' : ''} flex-1">${escHtml(item.text)}</span>
          <button onclick="event.stopPropagation();removePackingItem(${ci},${ii})" class="text-red-300 hover:text-red-500 text-xs p-1 transition" aria-label="Remove">‚úï</button>
        </div>`).join('')}
      </div>
      <div class="flex gap-2 mt-3">
        <input type="text" id="packAdd-${ci}" class="flex-1 border border-gray-200 dark:border-gray-700 rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-teal-400" placeholder="Add item..." onkeydown="if(event.key==='Enter')addPackingItem(${ci})">
        <button onclick="addPackingItem(${ci})" class="tap px-4 py-2 bg-teal-600 text-white rounded-lg text-sm font-600 hover:bg-teal-700 transition">Add</button>
      </div>
    </div>
  </div>`;
}

function togglePackingCat(ci) {
  const body = document.getElementById('packBody-' + ci);
  const chev = document.getElementById('packChev-' + ci);
  if (body) body.classList.toggle('hidden');
  if (chev) chev.classList.toggle('open');
}

function togglePackingItem(ci, ii, which) {
  state.packingList[ci][which][ii].checked = !state.packingList[ci][which][ii].checked;
  saveState();
  renderPacking();
}

function addPackingItem(ci) {
  const input = document.getElementById('packAdd-' + ci);
  const text = input.value.trim();
  if (!text) return;
  state.packingList[ci].customItems.push({ text, checked: false });
  input.value = '';
  saveState();
  renderPacking();
}

function removePackingItem(ci, ii) {
  state.packingList[ci].customItems.splice(ii, 1);
  saveState();
  renderPacking();
}

function uncheckAllPacking() {
  state.packingList.forEach(cat => {
    cat.items.forEach(i => i.checked = false);
    cat.customItems.forEach(i => i.checked = false);
  });
  saveState();
  renderPacking();
}

function resetPacking() {
  if (!confirm('Reset packing list to defaults? Custom items will be removed.')) return;
  state.packingList = initPackingList();
  saveState();
  renderPacking();
}

// ============================================================
// RENDER: DAY EXPENSES (inline in day cards)
// ============================================================
function renderDayExpenses(dayNum) {
  const dayExps = state.expenses.filter(e => e.day === dayNum);
  const dayTotal = dayExps.reduce((s, e) => s + e.amount, 0);
  const tripTotal = state.expenses.reduce((s, e) => s + e.amount, 0);
  const budget = state.budget || 15000;
  const remaining = budget - tripTotal;
  const budgetPct = Math.min(100, Math.round((tripTotal / budget) * 100));
  const isOverBudget = tripTotal > budget;
  const barColor = isOverBudget ? 'bg-red-500' : budgetPct > 80 ? 'bg-amber-500' : 'bg-teal-500';

  const expListHtml = dayExps.length > 0 ? dayExps.map(e => {
    const cat = CATEGORIES.find(c => c.id === e.category) || CATEGORIES[7];
    return `<div class="flex items-center gap-2 py-1.5">
      <span class="text-sm">${cat.label.split(' ')[0]}</span>
      <span class="text-sm flex-1 truncate">${e.note ? escHtml(e.note) : cat.label.split(' ').slice(1).join(' ')}</span>
      <span class="font-heading font-700 text-sm text-teal-700 dark:text-teal-300 flex-shrink-0">$${e.amount.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
      <button onclick="removeDayExpense('${e.id}', ${dayNum})" class="text-red-300 hover:text-red-500 text-xs p-1 transition flex-shrink-0" aria-label="Delete">‚úï</button>
    </div>`;
  }).join('') : '<p class="text-xs text-gray-400 py-2">No expenses yet today.</p>';

  return `<div class="flex justify-between items-center mb-2">
    <p class="font-heading font-600 text-sm">üí∞ Today's Expenses</p>
    <span class="font-heading font-700 text-sm text-teal-700 dark:text-teal-300">$${dayTotal.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
  </div>
  <div class="mb-3">${expListHtml}</div>
  <!-- Quick add -->
  <div class="flex gap-2 mb-3">
    <span class="text-sm font-700 leading-9">$</span>
    <input type="number" id="quickExpAmt-${dayNum}" step="0.01" min="0" class="w-20 border border-gray-200 dark:border-gray-700 rounded-lg px-2 py-1.5 text-sm outline-none focus:ring-2 focus:ring-teal-400" placeholder="0.00" inputmode="decimal">
    <select id="quickExpCat-${dayNum}" class="flex-1 border border-gray-200 dark:border-gray-700 rounded-lg px-2 py-1.5 text-sm outline-none focus:ring-2 focus:ring-teal-400">
      ${CATEGORIES.map(c => `<option value="${c.id}">${c.label}</option>`).join('')}
    </select>
    <button onclick="quickAddExpense(${dayNum})" class="tap px-3 py-1.5 bg-teal-600 text-white rounded-lg text-sm font-600 hover:bg-teal-700 transition flex-shrink-0">Add</button>
  </div>
  <input type="text" id="quickExpNote-${dayNum}" class="w-full border border-gray-200 dark:border-gray-700 rounded-lg px-3 py-1.5 text-sm outline-none focus:ring-2 focus:ring-teal-400 mb-3" placeholder="Note (optional)">
  <!-- Budget bar -->
  <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-3">
    <div class="flex justify-between text-xs mb-1.5">
      <span class="font-600 ${isOverBudget ? 'text-red-600 dark:text-red-400' : 'text-gray-700 dark:text-gray-300'}">Trip total: $${tripTotal.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
      <span class="${isOverBudget ? 'text-red-600 dark:text-red-400' : remaining < 2000 ? 'text-amber-600 dark:text-amber-400' : 'text-green-600 dark:text-green-400'}">${isOverBudget ? 'Over by' : 'Left:'} $${Math.abs(remaining).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
    </div>
    <div class="progress-track"><div class="progress-fill ${barColor}" style="width:${budgetPct}%"></div></div>
    <p class="text-xs text-gray-400 mt-1 text-right">${budgetPct}% of $${budget.toLocaleString('en-US')} budget</p>
  </div>`;
}

function quickAddExpense(dayNum) {
  const amtInput = document.getElementById('quickExpAmt-' + dayNum);
  const catSelect = document.getElementById('quickExpCat-' + dayNum);
  const noteInput = document.getElementById('quickExpNote-' + dayNum);
  const amount = parseFloat(amtInput.value);
  if (isNaN(amount) || amount <= 0) return;
  state.expenses.push({
    id: genId(),
    amount,
    category: catSelect.value,
    note: noteInput.value.trim(),
    day: dayNum,
    timestamp: new Date().toISOString()
  });
  saveState();
  amtInput.value = '';
  noteInput.value = '';
  const container = document.getElementById('dayExpenses-' + dayNum);
  if (container) container.innerHTML = renderDayExpenses(dayNum);
}

function removeDayExpense(id, dayNum) {
  state.expenses = state.expenses.filter(e => e.id !== id);
  saveState();
  const container = document.getElementById('dayExpenses-' + dayNum);
  if (container) container.innerHTML = renderDayExpenses(dayNum);
}

// ============================================================
// RENDER: ALL DAYS
// ============================================================
let dayObserver = null;

function renderDays() {
  // Day nav
  const nav = document.getElementById('dayNav');
  nav.innerHTML = DAYS.map(d => `<button onclick="scrollToDay(${d.day})" class="day-nav-btn tap flex-shrink-0 px-3 py-1.5 rounded-full text-xs font-heading font-600 transition whitespace-nowrap" data-day="${d.day}" style="background:${phaseColor(d.phase)}20;color:${phaseColor(d.phase)}">${d.flag} ${d.day}</button>`).join('');

  // Day cards
  const cards = document.getElementById('dayCards');
  cards.innerHTML = DAYS.map(d => renderCollapsibleDay(d)).join('');

  // IntersectionObserver
  if (dayObserver) dayObserver.disconnect();
  dayObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const dayNum = parseInt(entry.target.dataset.day);
        highlightDayNav(dayNum);
      }
    });
  }, { threshold: 0.3, rootMargin: '-60px 0px -40% 0px' });

  document.querySelectorAll('[data-day-card]').forEach(el => dayObserver.observe(el));
}

function renderCollapsibleDay(d) {
  const isExpanded = state.expandedDays.includes(d.day);
  const ztlBanner = (d.phase === 'italy' || d.phase === 'transition') && d.ztlStatus === 'warn'
    ? `<div class="ztl-banner rounded-xl p-3 mb-3"><p class="font-heading font-600 text-sm">üö¶ ZTL Warning: ${escHtml(d.ztl)}</p></div>` : '';

  const driveRouteHtml = d.driveRoute ? `<div class="bg-amber-50 dark:bg-amber-900/30 rounded-xl p-3 mb-3">
    <p class="font-heading font-600 text-sm mb-2">üöó Drive Route</p>
    <ul class="text-sm space-y-1">${d.driveRoute.map(r => `<li class="flex gap-2"><span class="text-amber-500">‚Üí</span><span>${escHtml(r)}</span></li>`).join('')}</ul>
  </div>` : '';

  const parkingStrategyHtml = d.parkingStrategy ? `<div class="bg-blue-50 dark:bg-blue-900/30 rounded-xl p-3 mb-3">
    <p class="font-heading font-600 text-sm">üÖøÔ∏è Parking Strategy</p>
    <p class="text-sm mt-1">${escHtml(d.parkingStrategy)}</p>
  </div>` : '';

  const destsHtml = d.destinations && d.destinations.length > 0
    ? `<div class="mb-3"><p class="font-heading font-600 text-sm mb-2">üìç Destinations</p>
      <div class="dest-grid" style="gap:0.5rem">${d.destinations.map(dest => `<div class="glass rounded-xl p-3 hover:shadow-md transition">
        <div class="flex items-start gap-2">
          ${dest.star ? '<span class="text-amber-400 text-sm flex-shrink-0">‚≠ê</span>' : '<span class="text-gray-400 text-sm flex-shrink-0">üìç</span>'}
          <div class="flex-1 min-w-0"><p class="font-heading font-600 text-sm">${escHtml(dest.name)}</p><p class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">${escHtml(dest.desc)}</p>
            <div class="flex gap-3 mt-2">
              <a href="${dest.url}" target="_blank" rel="noopener noreferrer" class="text-xs font-600 text-teal-600 dark:text-teal-400 tap">Info ‚Üí</a>
              <a href="${mapsUrl(dest.name)}" target="_blank" rel="noopener noreferrer" class="text-xs font-600 text-blue-600 dark:text-blue-400 tap">üìç Navigate</a>
            </div>
          </div>
        </div>
      </div>`).join('')}</div></div>` : '';

  return `<div data-day-card data-day="${d.day}" id="day-${d.day}" class="rounded-2xl overflow-hidden shadow-lg">
    <button onclick="toggleDay(${d.day})" class="${phaseBg(d.phase)} text-white p-4 w-full text-left tap">
      <div class="flex justify-between items-center">
        <div>
          <p class="text-xs opacity-80 font-body">${d.date} (${d.weekday})</p>
          <h3 class="font-heading font-700 text-lg mt-0.5">${d.flag} Day ${d.day} ‚Äî ${escHtml(d.title)}</h3>
        </div>
        <span class="chevron text-white text-lg ${isExpanded ? 'open' : ''}" id="chev-${d.day}">‚ñº</span>
      </div>
      <div class="flex flex-wrap gap-2 mt-2 text-xs opacity-90">
        <span>‚òÄÔ∏è ${escHtml(d.am.substring(0, 40))}${d.am.length > 40 ? '...' : ''}</span>
      </div>
      <div class="mt-1 text-xs opacity-80">üõè ${escHtml(d.sleep)} ${d.sleepIcon}</div>
    </button>
    <div id="dayBody-${d.day}" class="bg-white dark:bg-gray-800 ${isExpanded ? '' : 'hidden'}">
      <div class="p-4 ${isExpanded ? 'anim-slide' : ''}">
        <div class="grid grid-cols-1 gap-2 mb-3">
          <div class="flex gap-2 items-start"><span class="text-amber-400 flex-shrink-0">‚òÄÔ∏è</span><p class="text-sm"><strong>AM:</strong> ${escHtml(d.am)}</p></div>
          <div class="flex gap-2 items-start"><span class="flex-shrink-0">üåô</span><p class="text-sm"><strong>PM:</strong> ${escHtml(d.pm)}</p></div>
        </div>
        <div class="flex flex-wrap gap-2 mb-3 text-xs">
          <span class="px-2 py-1 rounded-full bg-indigo-50 dark:bg-indigo-900/30">üõè ${escHtml(d.sleep)} ${d.sleepIcon}</span>
          <span class="px-2 py-1 rounded-full ${d.parkingStatus === 'warn' ? 'bg-amber-50 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300' : 'bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-300'}">${escHtml(d.parking)}</span>
          ${d.ztl !== '‚Äî' ? `<span class="px-2 py-1 rounded-full ${d.ztlStatus === 'warn' ? 'bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300' : 'bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-300'}">${escHtml(d.ztl)}</span>` : ''}
        </div>
        ${ztlBanner}
        <div class="family-tip rounded-xl p-3 mb-3">
          <p class="font-heading font-600 text-sm mb-1">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Tip</p>
          <p class="text-sm">${escHtml(d.familyTip)}</p>
        </div>
        ${driveRouteHtml}
        ${parkingStrategyHtml}
        ${destsHtml}
        ${renderMidwayStops(d)}
        ${renderAlternatives(d)}
      </div>
    </div>
  </div>`;
}

function toggleDay(dayNum) {
  const idx = state.expandedDays.indexOf(dayNum);
  if (idx >= 0) {
    state.expandedDays.splice(idx, 1);
  } else {
    state.expandedDays.push(dayNum);
  }
  saveState();
  const body = document.getElementById('dayBody-' + dayNum);
  const chev = document.getElementById('chev-' + dayNum);
  if (body) {
    body.classList.toggle('hidden');
    if (!body.classList.contains('hidden')) {
      body.querySelector('div').classList.add('anim-slide');
    }
  }
  if (chev) chev.classList.toggle('open');
}

function scrollToDay(dayNum) {
  const el = document.getElementById('day-' + dayNum);
  if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function highlightDayNav(dayNum) {
  document.querySelectorAll('.day-nav-btn').forEach(btn => {
    const d = parseInt(btn.dataset.day);
    const dayData = DAYS[d - 1];
    if (d === dayNum) {
      btn.style.background = phaseColor(dayData.phase);
      btn.style.color = '#fff';
    } else {
      btn.style.background = phaseColor(dayData.phase) + '20';
      btn.style.color = phaseColor(dayData.phase);
    }
  });
}

// ============================================================
// RENDER: NOTES & LISTS
// ============================================================
function renderNotes() {
  renderJournal();
  renderChecklists();
  renderExpenses();
  switchNotesTab(state.activeNotesTab || 'journal');
}

// ---- Journal ----
function renderJournal() {
  const el = document.getElementById('notes-journal');
  const notes = state.notes.filter(n => !n.id.startsWith('today-')).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
  el.innerHTML = `
    <button onclick="showAddNoteModal()" class="tap w-full bg-teal-600 hover:bg-teal-700 text-white font-heading font-600 py-3 px-4 rounded-xl mb-4 transition text-sm">+ Add Note</button>
    ${notes.length === 0 ? '<p class="text-center text-gray-400 py-8 text-sm">No notes yet. Tap "Add Note" to start your journal!</p>' : ''}
    <div class="space-y-3">${notes.map(n => `<div class="glass rounded-xl p-3 anim-fade">
      <div class="flex justify-between items-start">
        <div class="flex-1">
          <p class="text-sm whitespace-pre-wrap">${escHtml(n.text)}</p>
          <div class="flex items-center gap-2 mt-2">
            <span class="text-xs text-gray-400">${formatTimestamp(n.timestamp)}</span>
            ${n.day !== 'general' ? `<span class="text-xs px-2 py-0.5 rounded-full bg-teal-50 dark:bg-teal-900/30 text-teal-700 dark:text-teal-300">Day ${n.day}</span>` : '<span class="text-xs px-2 py-0.5 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-500">General</span>'}
          </div>
        </div>
        <button onclick="deleteNote('${n.id}')" class="tap text-red-400 hover:text-red-600 ml-2 text-lg transition p-1" aria-label="Delete note">üóë</button>
      </div>
    </div>`).join('')}</div>`;
}

function showAddNoteModal() {
  const modal = document.getElementById('modalContainer');
  modal.innerHTML = `<div class="modal-overlay" onclick="if(event.target===this)closeModal()">
    <div class="modal-content bg-white dark:bg-gray-800 anim-fade">
      <h3 class="font-heading font-700 text-lg mb-3">üìù Add Note</h3>
      <textarea id="noteText" class="w-full border border-gray-200 dark:border-gray-700 rounded-xl p-3 text-sm resize-none h-28 focus:ring-2 focus:ring-teal-400 outline-none mb-3" placeholder="What's on your mind?" autofocus></textarea>
      <select id="noteDay" class="w-full border border-gray-200 dark:border-gray-700 rounded-xl p-3 text-sm mb-4 outline-none focus:ring-2 focus:ring-teal-400">
        <option value="general">General</option>
        ${DAYS.map(d => `<option value="${d.day}">Day ${d.day} ‚Äî ${d.title}</option>`).join('')}
      </select>
      <div class="flex gap-3">
        <button onclick="closeModal()" class="tap flex-1 py-3 rounded-xl border border-gray-200 dark:border-gray-700 font-heading font-600 text-sm transition">Cancel</button>
        <button onclick="addNote()" class="tap flex-1 py-3 rounded-xl bg-teal-600 text-white font-heading font-600 text-sm hover:bg-teal-700 transition">Save</button>
      </div>
    </div>
  </div>`;
}

function addNote() {
  const text = document.getElementById('noteText').value.trim();
  if (!text) return;
  const dayVal = document.getElementById('noteDay').value;
  state.notes.push({
    id: genId(),
    text,
    day: dayVal === 'general' ? 'general' : parseInt(dayVal),
    timestamp: new Date().toISOString()
  });
  saveState();
  closeModal();
  renderJournal();
}

function deleteNote(id) {
  if (!confirm('Delete this note?')) return;
  state.notes = state.notes.filter(n => n.id !== id);
  saveState();
  renderJournal();
}

function closeModal() {
  document.getElementById('modalContainer').innerHTML = '';
}

// ---- Checklists ----
function renderChecklists() {
  const el = document.getElementById('notes-checklists');
  const keys = Object.keys(state.checklists);
  el.innerHTML = `
    <button onclick="showNewChecklistModal()" class="tap w-full bg-teal-600 hover:bg-teal-700 text-white font-heading font-600 py-3 px-4 rounded-xl mb-4 transition text-sm">+ New Checklist</button>
    <div class="space-y-4">${keys.map(k => renderChecklist(k, state.checklists[k])).join('')}</div>`;
}

function renderChecklist(key, cl) {
  const total = cl.items.length;
  const checked = cl.items.filter(i => i.checked).length;
  const pct = total > 0 ? Math.round((checked / total) * 100) : 0;
  return `<div class="glass rounded-2xl p-4">
    <div class="flex justify-between items-center mb-2">
      <h4 class="font-heading font-700 text-base">${escHtml(cl.title)}</h4>
      <span class="text-xs text-gray-400">${checked}/${total}</span>
    </div>
    <div class="progress-track mb-3"><div class="progress-fill bg-teal-500" style="width:${pct}%"></div></div>
    <div class="space-y-2">${cl.items.map((item, i) => `<div class="flex items-center gap-3 tap" onclick="toggleCheckItem('${key}',${i})">
      <div class="check-box ${item.checked ? 'checked' : ''}"></div>
      <span class="text-sm ${item.checked ? 'line-through text-gray-400' : ''} flex-1">${escHtml(item.text)}</span>
      <button onclick="event.stopPropagation();removeCheckItem('${key}',${i})" class="text-red-300 hover:text-red-500 text-xs p-1 transition" aria-label="Remove item">‚úï</button>
    </div>`).join('')}</div>
    <div class="flex gap-2 mt-3">
      <input type="text" id="newItem-${key}" class="flex-1 border border-gray-200 dark:border-gray-700 rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-teal-400" placeholder="Add item..." onkeydown="if(event.key==='Enter')addCheckItem('${key}')">
      <button onclick="addCheckItem('${key}')" class="tap px-4 py-2 bg-teal-600 text-white rounded-lg text-sm font-600 hover:bg-teal-700 transition">Add</button>
    </div>
  </div>`;
}

function toggleCheckItem(key, idx) {
  state.checklists[key].items[idx].checked = !state.checklists[key].items[idx].checked;
  saveState();
  renderChecklists();
}

function removeCheckItem(key, idx) {
  state.checklists[key].items.splice(idx, 1);
  saveState();
  renderChecklists();
}

function addCheckItem(key) {
  const input = document.getElementById('newItem-' + key);
  const text = input.value.trim();
  if (!text) return;
  state.checklists[key].items.push({ text, checked: false });
  input.value = '';
  saveState();
  renderChecklists();
}

function showNewChecklistModal() {
  const modal = document.getElementById('modalContainer');
  modal.innerHTML = `<div class="modal-overlay" onclick="if(event.target===this)closeModal()">
    <div class="modal-content bg-white dark:bg-gray-800 anim-fade">
      <h3 class="font-heading font-700 text-lg mb-3">‚úÖ New Checklist</h3>
      <input type="text" id="newClTitle" class="w-full border border-gray-200 dark:border-gray-700 rounded-xl p-3 text-sm mb-4 outline-none focus:ring-2 focus:ring-teal-400" placeholder="Checklist name (e.g., Shopping List)" autofocus>
      <div class="flex gap-3">
        <button onclick="closeModal()" class="tap flex-1 py-3 rounded-xl border border-gray-200 dark:border-gray-700 font-heading font-600 text-sm transition">Cancel</button>
        <button onclick="createChecklist()" class="tap flex-1 py-3 rounded-xl bg-teal-600 text-white font-heading font-600 text-sm hover:bg-teal-700 transition">Create</button>
      </div>
    </div>
  </div>`;
}

function createChecklist() {
  const title = document.getElementById('newClTitle').value.trim();
  if (!title) return;
  const key = 'custom_' + genId();
  state.checklists[key] = { title, items: [] };
  saveState();
  closeModal();
  renderChecklists();
}

// ---- Expenses ----
function renderExpenses() {
  const el = document.getElementById('notes-expenses');
  const expenses = state.expenses;
  const total = expenses.reduce((s, e) => s + e.amount, 0);
  const budget = state.budget || 15000;
  const remaining = budget - total;
  const budgetPct = Math.min(100, Math.round((total / budget) * 100));
  const isOverBudget = total > budget;
  const byCategory = {};
  CATEGORIES.forEach(c => { byCategory[c.id] = 0; });
  expenses.forEach(e => { byCategory[e.category] = (byCategory[e.category] || 0) + e.amount; });
  const tripDay = getTripDay();
  const daysElapsed = tripDay.status === 'during' ? tripDay.dayNum : tripDay.status === 'after' ? 11 : 1;
  const perDay = daysElapsed > 0 ? (total / daysElapsed) : 0;
  const daysRemaining = tripDay.status === 'during' ? (11 - tripDay.dayNum) : tripDay.status === 'before' ? 11 : 0;
  const dailyBudgetRemaining = daysRemaining > 0 ? (remaining / daysRemaining) : 0;

  // Budget tracker ‚Äî always visible
  const budgetBarColor = isOverBudget ? 'bg-red-500' : budgetPct > 80 ? 'bg-amber-500' : 'bg-teal-500';
  const budgetHtml = `<div class="glass rounded-2xl p-4 mb-4">
    <div class="flex justify-between items-center mb-2">
      <h4 class="font-heading font-700 text-base">üí∞ Trip Budget</h4>
      <button onclick="showEditBudgetModal()" class="tap text-xs px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-full font-600 transition">Edit</button>
    </div>
    <div class="flex justify-between items-end mb-2">
      <div>
        <p class="font-heading font-800 text-2xl ${isOverBudget ? 'text-red-600 dark:text-red-400' : 'text-teal-700 dark:text-teal-300'}">$${total.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</p>
        <p class="text-xs text-gray-500 dark:text-gray-400">of $${budget.toLocaleString('en-US')} budget</p>
      </div>
      <div class="text-right">
        <p class="font-heading font-700 text-lg ${isOverBudget ? 'text-red-600 dark:text-red-400' : remaining < 2000 ? 'text-amber-600 dark:text-amber-400' : 'text-green-600 dark:text-green-400'}">$${Math.abs(remaining).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</p>
        <p class="text-xs text-gray-500 dark:text-gray-400">${isOverBudget ? 'over budget' : 'remaining'}</p>
      </div>
    </div>
    <div class="progress-track mb-3"><div class="progress-fill ${budgetBarColor}" style="width:${budgetPct}%"></div></div>
    <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400">
      <span>${budgetPct}% used</span>
      ${daysRemaining > 0 ? `<span>~$${dailyBudgetRemaining.toFixed(0)}/day left to spend</span>` : ''}
    </div>
  </div>`;

  const summaryHtml = expenses.length > 0 ? `<div class="glass rounded-2xl p-4 mb-4">
    <div class="flex justify-between items-center mb-3">
      <h4 class="font-heading font-700 text-base">üìä Spending Breakdown</h4>
      <button onclick="exportExpenses()" class="tap text-xs px-3 py-1 bg-teal-600 text-white rounded-full font-600 hover:bg-teal-700 transition">üìã Export</button>
    </div>
    <div class="grid grid-cols-2 gap-3 mb-3">
      <div class="bg-teal-50 dark:bg-teal-900/30 rounded-xl p-3 text-center">
        <p class="text-xs text-gray-500 dark:text-gray-400">Total Spent</p>
        <p class="font-heading font-700 text-xl text-teal-700 dark:text-teal-300">$${total.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</p>
      </div>
      <div class="bg-indigo-50 dark:bg-indigo-900/30 rounded-xl p-3 text-center">
        <p class="text-xs text-gray-500 dark:text-gray-400">Per Day Avg</p>
        <p class="font-heading font-700 text-xl text-indigo-700 dark:text-indigo-300">$${perDay.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</p>
      </div>
    </div>
    <div class="flex flex-wrap gap-2">${CATEGORIES.filter(c => byCategory[c.id] > 0).map(c => `<span class="px-2 py-1 rounded-full text-xs font-600 ${c.color}">${c.label} $${byCategory[c.id].toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>`).join('')}</div>
  </div>` : '';

  el.innerHTML = `
    ${budgetHtml}
    ${summaryHtml}
    <button onclick="showAddExpenseModal()" class="tap w-full bg-teal-600 hover:bg-teal-700 text-white font-heading font-600 py-3 px-4 rounded-xl mb-4 transition text-sm">+ Add Expense</button>
    ${expenses.length === 0 ? '<p class="text-center text-gray-400 py-8 text-sm">No expenses logged yet. Tap above to start tracking!</p>' : ''}
    <div class="space-y-2">${expenses.slice().reverse().map(e => {
      const cat = CATEGORIES.find(c => c.id === e.category) || CATEGORIES[7];
      return `<div class="glass rounded-xl p-3 flex items-center gap-3" onclick="showEditExpenseModal('${e.id}')">
        <span class="text-lg">${cat.label.split(' ')[0]}</span>
        <div class="flex-1 min-w-0">
          <p class="text-sm font-600 truncate">${e.note ? escHtml(e.note) : cat.label}</p>
          <p class="text-xs text-gray-400">Day ${e.day} ¬∑ ${formatTimestamp(e.timestamp)}</p>
        </div>
        <span class="font-heading font-700 text-sm text-teal-700 dark:text-teal-300 flex-shrink-0">$${e.amount.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
      </div>`;
    }).join('')}</div>`;
}

function showEditBudgetModal() {
  const modal = document.getElementById('modalContainer');
  modal.innerHTML = `<div class="modal-overlay" onclick="if(event.target===this)closeModal()">
    <div class="modal-content bg-white dark:bg-gray-800 anim-fade">
      <h3 class="font-heading font-700 text-lg mb-3">üí∞ Edit Budget Target</h3>
      <div class="flex items-center gap-2 mb-4">
        <span class="text-lg font-700">$</span>
        <input type="number" id="budgetInput" step="100" min="0" class="flex-1 border border-gray-200 dark:border-gray-700 rounded-xl p-3 text-sm outline-none focus:ring-2 focus:ring-teal-400" value="${state.budget || 15000}" inputmode="numeric" autofocus>
      </div>
      <div class="flex gap-3">
        <button onclick="closeModal()" class="tap flex-1 py-3 rounded-xl border border-gray-200 dark:border-gray-700 font-heading font-600 text-sm transition">Cancel</button>
        <button onclick="saveBudget()" class="tap flex-1 py-3 rounded-xl bg-teal-600 text-white font-heading font-600 text-sm hover:bg-teal-700 transition">Save</button>
      </div>
    </div>
  </div>`;
}

function saveBudget() {
  const val = parseFloat(document.getElementById('budgetInput').value);
  if (isNaN(val) || val <= 0) return;
  state.budget = val;
  saveState();
  closeModal();
  renderExpenses();
}

function showAddExpenseModal(editId) {
  const existing = editId ? state.expenses.find(e => e.id === editId) : null;
  const trip = getTripDay();
  const defaultDay = existing ? existing.day : (trip.status === 'during' ? trip.dayNum : 1);
  const modal = document.getElementById('modalContainer');
  modal.innerHTML = `<div class="modal-overlay" onclick="if(event.target===this)closeModal()">
    <div class="modal-content bg-white dark:bg-gray-800 anim-fade">
      <h3 class="font-heading font-700 text-lg mb-3">üí∞ ${existing ? 'Edit' : 'Add'} Expense</h3>
      <div class="flex items-center gap-2 mb-3">
        <span class="text-lg font-700">$</span>
        <input type="number" id="expAmount" step="0.01" min="0" class="flex-1 border border-gray-200 dark:border-gray-700 rounded-xl p-3 text-sm outline-none focus:ring-2 focus:ring-teal-400" placeholder="0.00" value="${existing ? existing.amount : ''}" inputmode="decimal" autofocus>
      </div>
      <select id="expCategory" class="w-full border border-gray-200 dark:border-gray-700 rounded-xl p-3 text-sm mb-3 outline-none focus:ring-2 focus:ring-teal-400">
        ${CATEGORIES.map(c => `<option value="${c.id}" ${existing && existing.category === c.id ? 'selected' : ''}>${c.label}</option>`).join('')}
      </select>
      <input type="text" id="expNote" class="w-full border border-gray-200 dark:border-gray-700 rounded-xl p-3 text-sm mb-3 outline-none focus:ring-2 focus:ring-teal-400" placeholder="Note (optional)" value="${existing ? escHtml(existing.note || '') : ''}">
      <select id="expDay" class="w-full border border-gray-200 dark:border-gray-700 rounded-xl p-3 text-sm mb-4 outline-none focus:ring-2 focus:ring-teal-400">
        ${DAYS.map(d => `<option value="${d.day}" ${d.day === defaultDay ? 'selected' : ''}>Day ${d.day} ‚Äî ${d.title}</option>`).join('')}
      </select>
      <div class="flex gap-3">
        ${existing ? `<button onclick="deleteExpense('${existing.id}')" class="tap py-3 px-4 rounded-xl bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 font-heading font-600 text-sm transition">Delete</button>` : ''}
        <button onclick="closeModal()" class="tap flex-1 py-3 rounded-xl border border-gray-200 dark:border-gray-700 font-heading font-600 text-sm transition">Cancel</button>
        <button onclick="saveExpense('${editId || ''}')" class="tap flex-1 py-3 rounded-xl bg-teal-600 text-white font-heading font-600 text-sm hover:bg-teal-700 transition">Save</button>
      </div>
    </div>
  </div>`;
}

function showEditExpenseModal(id) {
  showAddExpenseModal(id);
}

function saveExpense(editId) {
  const amount = parseFloat(document.getElementById('expAmount').value);
  if (isNaN(amount) || amount <= 0) return;
  const category = document.getElementById('expCategory').value;
  const note = document.getElementById('expNote').value.trim();
  const day = parseInt(document.getElementById('expDay').value);
  if (editId) {
    const exp = state.expenses.find(e => e.id === editId);
    if (exp) {
      exp.amount = amount;
      exp.category = category;
      exp.note = note;
      exp.day = day;
    }
  } else {
    state.expenses.push({ id: genId(), amount, category, note, day, timestamp: new Date().toISOString() });
  }
  saveState();
  closeModal();
  renderExpenses();
}

function deleteExpense(id) {
  if (!confirm('Delete this expense?')) return;
  state.expenses = state.expenses.filter(e => e.id !== id);
  saveState();
  closeModal();
  renderExpenses();
}

function exportExpenses() {
  const expenses = state.expenses;
  if (expenses.length === 0) { alert('No expenses to export.'); return; }
  const total = expenses.reduce((s, e) => s + e.amount, 0);
  const budget = state.budget || 15000;
  let text = 'Alps to Tuscany ‚Äî Expense Report\n';
  text += '================================\n\n';
  text += `Budget: $${budget.toLocaleString()}\n`;
  text += `Spent:  $${total.toFixed(2)}\n`;
  text += `Remaining: $${(budget - total).toFixed(2)}\n\n`;
  expenses.forEach(e => {
    const cat = CATEGORIES.find(c => c.id === e.category) || CATEGORIES[7];
    text += `Day ${e.day} | ${cat.label} | $${e.amount.toFixed(2)}${e.note ? ' | ' + e.note : ''}\n`;
  });
  text += `\n================================\nTotal: $${total.toFixed(2)} / $${budget.toLocaleString()} budget\n`;
  const byCategory = {};
  expenses.forEach(e => { byCategory[e.category] = (byCategory[e.category] || 0) + e.amount; });
  text += '\nBy Category:\n';
  CATEGORIES.forEach(c => {
    if (byCategory[c.id]) text += `  ${c.label}: $${byCategory[c.id].toFixed(2)}\n`;
  });
  navigator.clipboard.writeText(text).then(() => {
    alert('Expense report copied to clipboard!');
  }).catch(() => {
    // Fallback
    const ta = document.createElement('textarea');
    ta.value = text; document.body.appendChild(ta); ta.select(); document.execCommand('copy');
    document.body.removeChild(ta);
    alert('Expense report copied to clipboard!');
  });
}

// ============================================================
// RENDER: SETTINGS
// ============================================================
function renderSettings() {
  const el = document.getElementById('settingsContent');
  const totalNotes = state.notes.filter(n => !n.id.startsWith('today-')).length;
  const totalExpenses = state.expenses.length;
  const totalSpent = state.expenses.reduce((s, e) => s + e.amount, 0);
  const checklistItems = Object.values(state.checklists).reduce((s, cl) => s + cl.items.length, 0);
  const checkedItems = Object.values(state.checklists).reduce((s, cl) => s + cl.items.filter(i => i.checked).length, 0);

  el.innerHTML = `
    <h2 class="font-heading font-700 text-xl mb-4">‚öôÔ∏è Settings</h2>

    <!-- Dark Mode & Font Size -->
    <div class="glass rounded-2xl p-4 mb-4 space-y-4">
      <div class="flex items-center justify-between">
        <div>
          <p class="font-heading font-600 text-sm">üåô Dark Mode</p>
          <p class="text-xs text-gray-400">Essential for nighttime hotel use</p>
        </div>
        <button onclick="toggleDarkMode()" class="tap w-14 h-8 rounded-full transition ${state.darkMode ? 'bg-teal-600' : 'bg-gray-300'} relative">
          <span class="absolute top-1 ${state.darkMode ? 'right-1' : 'left-1'} w-6 h-6 bg-white rounded-full shadow transition-all"></span>
        </button>
      </div>
      <div class="border-t border-gray-200 dark:border-gray-700 pt-4 flex items-center justify-between">
        <div>
          <p class="font-heading font-600 text-sm">üî§ Font Size</p>
          <p class="text-xs text-gray-400">${FONT_SIZES[state.fontSize || 0].desc}</p>
        </div>
        <div class="flex items-center gap-1">
          ${FONT_SIZES.map((f, i) => `<button onclick="state.fontSize=${i};applyFontSize();saveState();renderSettings();" class="tap w-10 h-10 rounded-xl font-heading font-700 text-sm transition ${(state.fontSize || 0) === i ? 'bg-teal-600 text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300'}">${f.label}</button>`).join('')}
        </div>
      </div>
    </div>

    <!-- Trip Stats -->
    <div class="glass rounded-2xl p-4 mb-4">
      <h3 class="font-heading font-700 text-base mb-3">üìä Trip Stats</h3>
      <div class="grid grid-cols-3 gap-3">
        <div class="text-center"><p class="font-heading font-700 text-xl text-teal-600 dark:text-teal-400">11</p><p class="text-xs text-gray-400">Days</p></div>
        <div class="text-center"><p class="font-heading font-700 text-xl text-teal-600 dark:text-teal-400">5</p><p class="text-xs text-gray-400">Hotels</p></div>
        <div class="text-center"><p class="font-heading font-700 text-xl text-teal-600 dark:text-teal-400">2</p><p class="text-xs text-gray-400">Countries</p></div>
      </div>
      <div class="border-t border-gray-200 dark:border-gray-700 mt-3 pt-3 grid grid-cols-2 gap-3 text-center">
        <div><p class="font-heading font-600 text-sm">${totalNotes}</p><p class="text-xs text-gray-400">Journal Notes</p></div>
        <div><p class="font-heading font-600 text-sm">$${totalSpent.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</p><p class="text-xs text-gray-400">of $${(state.budget || 15000).toLocaleString()} budget</p></div>
        <div><p class="font-heading font-600 text-sm">${totalExpenses}</p><p class="text-xs text-gray-400">Expenses</p></div>
        <div><p class="font-heading font-600 text-sm">${checkedItems}/${checklistItems}</p><p class="text-xs text-gray-400">Items Checked</p></div>
      </div>
    </div>

    <!-- ZTL Quick Reference -->
    <div class="glass rounded-2xl p-4 mb-4">
      <h3 class="font-heading font-700 text-base mb-3">üö¶ ZTL Quick Reference</h3>
      <div class="space-y-2">
        <div class="flex items-center gap-3 p-2 bg-green-50 dark:bg-green-900/20 rounded-xl">
          <span class="text-lg">üá¶üáπ</span>
          <div class="flex-1"><p class="text-sm font-600">Austria</p><p class="text-xs text-gray-500 dark:text-gray-400">No ZTL ‚Äî drive freely</p></div>
          <span class="text-green-500">‚úÖ</span>
        </div>
        <div class="flex items-center gap-3 p-2 bg-amber-50 dark:bg-amber-900/20 rounded-xl">
          <span class="text-lg">üáÆüáπ</span>
          <div class="flex-1"><p class="text-sm font-600">Tuscany Towns</p><p class="text-xs text-gray-500 dark:text-gray-400">NEVER drive inside walled town centers</p></div>
          <span class="text-amber-500">‚ö†Ô∏è</span>
        </div>
        <div class="flex items-center gap-3 p-2 bg-amber-50 dark:bg-amber-900/20 rounded-xl">
          <span class="text-lg">üáÆüáπ</span>
          <div class="flex-1"><p class="text-sm font-600">Verona</p><p class="text-xs text-gray-500 dark:text-gray-400">Stay outside old town. Park at Cittadella garage.</p></div>
          <span class="text-amber-500">‚ö†Ô∏è</span>
        </div>
        <div class="flex items-center gap-3 p-2 bg-red-50 dark:bg-red-900/20 rounded-xl">
          <span class="text-lg">üáÆüáπ</span>
          <div class="flex-1"><p class="text-sm font-600">Florence</p><p class="text-xs text-gray-500 dark:text-gray-400">DO NOT enter city center. Airport area only!</p></div>
          <span class="text-red-500">üõë</span>
        </div>
      </div>
      <div class="ztl-danger rounded-xl p-3 mt-3">
        <p class="font-heading font-700 text-sm mb-1">üí∏ Fine Alert</p>
        <p class="text-sm">‚Ç¨80‚Äì‚Ç¨335 PER camera entry + ‚Ç¨45 rental car admin fee. Cameras automatic. Fines arrive 6-12 months later. GPS does NOT warn you!</p>
      </div>
      <div class="flex flex-wrap gap-2 mt-3">
        <a href="https://www.visitflorence.com/tourist-info/driving-in-florence-ztl-zone.html" target="_blank" rel="noopener noreferrer" class="tap text-xs px-3 py-1.5 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full font-600 transition">Florence ZTL Map ‚Üí</a>
        <a href="https://mominitaly.com/ztl-in-italy/" target="_blank" rel="noopener noreferrer" class="tap text-xs px-3 py-1.5 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full font-600 transition">Italy ZTL Guide ‚Üí</a>
        <a href="https://www.autoeurope.com/italy-ztl-zones/" target="_blank" rel="noopener noreferrer" class="tap text-xs px-3 py-1.5 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full font-600 transition">Auto Europe ZTL Maps ‚Üí</a>
      </div>
    </div>

    <!-- Cloud Sync -->
    <div class="glass rounded-2xl p-4 mb-4">
      <h3 class="font-heading font-700 text-base mb-3">‚òÅÔ∏è Cloud Sync</h3>
      <p class="text-xs text-gray-500 dark:text-gray-400 mb-3">Sync your data across all devices using GitHub. Enter your token once ‚Äî it stays saved on this device.</p>
      <div class="space-y-3">
        <div>
          <label class="text-xs font-600 text-gray-600 dark:text-gray-400 mb-1 block">GitHub Token</label>
          <input type="password" id="syncToken" class="w-full border border-gray-200 dark:border-gray-700 rounded-xl p-3 text-sm outline-none focus:ring-2 focus:ring-teal-400" placeholder="ghp_..." value="${escHtml(getSyncToken())}">
        </div>
        <div class="flex gap-3">
          <button onclick="syncToCloud()" class="tap flex-1 py-3 rounded-xl bg-teal-600 text-white font-heading font-600 text-sm hover:bg-teal-700 transition">‚¨ÜÔ∏è Push to Cloud</button>
          <button onclick="syncFromCloud()" class="tap flex-1 py-3 rounded-xl bg-indigo-600 text-white font-heading font-600 text-sm hover:bg-indigo-700 transition">‚¨áÔ∏è Pull from Cloud</button>
        </div>
        <div id="syncStatus" class="text-xs text-center text-gray-400"></div>
        ${getSyncGistId() ? '<p class="text-xs text-green-600 dark:text-green-400 text-center">‚úÖ Linked to cloud</p>' : '<p class="text-xs text-gray-400 text-center">Not yet linked ‚Äî push to create your sync</p>'}
      </div>
    </div>

    <!-- Data Management -->
    <div class="glass rounded-2xl p-4 mb-4">
      <h3 class="font-heading font-700 text-base mb-3">üì¶ Data Management</h3>
      <div class="space-y-3">
        <button onclick="exportAllData()" class="tap w-full py-3 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded-xl font-heading font-600 text-sm hover:bg-indigo-100 dark:hover:bg-indigo-900/50 transition">üìã Export All Data (Clipboard)</button>
        <button onclick="clearAllData()" class="tap w-full py-3 bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-xl font-heading font-600 text-sm hover:bg-red-100 dark:hover:bg-red-900/50 transition">üóë Clear All Data</button>
      </div>
    </div>

    <p class="text-center text-xs text-gray-400 mt-6 mb-4">Alps to Tuscany Family Trip Hub ¬∑ Mar 23 ‚Äì Apr 2, 2026</p>
  `;
}

function exportAllData() {
  const json = JSON.stringify(state, null, 2);
  navigator.clipboard.writeText(json).then(() => {
    alert('All data copied to clipboard as JSON!');
  }).catch(() => {
    const ta = document.createElement('textarea');
    ta.value = json; document.body.appendChild(ta); ta.select(); document.execCommand('copy');
    document.body.removeChild(ta);
    alert('All data copied to clipboard as JSON!');
  });
}

function clearAllData() {
  if (!confirm('Are you sure you want to clear ALL data? This will reset notes, expenses, and checklists. This cannot be undone!')) return;
  if (!confirm('Really clear everything? Last chance!')) return;
  state.notes = [{ ...DEFAULT_NOTE }];
  state.checklists = JSON.parse(JSON.stringify(DEFAULT_CHECKLISTS));
  state.expenses = [];
  state.expandedDays = [];
  saveState();
  renderSettings();
  renderNotes();
  alert('All data has been cleared.');
}

// ============================================================
// CLOUD SYNC (GitHub Gist)
// ============================================================
const SYNC_TOKEN_KEY = 'TRIP_HUB_SYNC_TOKEN';
const SYNC_GIST_KEY = 'TRIP_HUB_SYNC_GIST';
const GIST_FILENAME = 'europe26-trip-data.json';

function getSyncToken() {
  return localStorage.getItem(SYNC_TOKEN_KEY) || '';
}

function getSyncGistId() {
  return localStorage.getItem(SYNC_GIST_KEY) || '';
}

function saveSyncToken(token) {
  localStorage.setItem(SYNC_TOKEN_KEY, token);
}

function setSyncStatus(msg, isError) {
  const el = document.getElementById('syncStatus');
  if (el) {
    el.textContent = msg;
    el.className = 'text-xs text-center ' + (isError ? 'text-red-500' : 'text-green-600 dark:text-green-400');
  }
}

async function syncToCloud() {
  const token = document.getElementById('syncToken').value.trim();
  if (!token) { setSyncStatus('Please enter your GitHub token', true); return; }
  saveSyncToken(token);
  setSyncStatus('Pushing...', false);

  const body = JSON.stringify(state, null, 2);
  const gistId = getSyncGistId();

  try {
    if (gistId) {
      // Update existing gist
      const res = await fetch('https://api.github.com/gists/' + gistId, {
        method: 'PATCH',
        headers: { 'Authorization': 'token ' + token, 'Content-Type': 'application/json' },
        body: JSON.stringify({ files: { [GIST_FILENAME]: { content: body } } })
      });
      if (!res.ok) throw new Error('Update failed: ' + res.status);
      setSyncStatus('Pushed! ' + new Date().toLocaleTimeString(), false);
    } else {
      // Create new gist
      const res = await fetch('https://api.github.com/gists', {
        method: 'POST',
        headers: { 'Authorization': 'token ' + token, 'Content-Type': 'application/json' },
        body: JSON.stringify({
          description: 'Alps to Tuscany ‚Äî Trip Hub Data',
          public: false,
          files: { [GIST_FILENAME]: { content: body } }
        })
      });
      if (!res.ok) throw new Error('Create failed: ' + res.status);
      const data = await res.json();
      localStorage.setItem(SYNC_GIST_KEY, data.id);
      setSyncStatus('Synced! Cloud storage created.', false);
    }
    renderSettings();
  } catch (e) {
    setSyncStatus('Error: ' + e.message, true);
  }
}

async function syncFromCloud() {
  const token = document.getElementById('syncToken').value.trim();
  if (!token) { setSyncStatus('Please enter your GitHub token', true); return; }
  saveSyncToken(token);

  const gistId = getSyncGistId();
  if (!gistId) {
    // Try to find existing gist by searching user's gists
    setSyncStatus('Searching for existing sync...', false);
    try {
      const res = await fetch('https://api.github.com/gists?per_page=100', {
        headers: { 'Authorization': 'token ' + token }
      });
      if (!res.ok) throw new Error('Failed to list gists: ' + res.status);
      const gists = await res.json();
      const found = gists.find(g => g.files && g.files[GIST_FILENAME]);
      if (found) {
        localStorage.setItem(SYNC_GIST_KEY, found.id);
        return syncFromCloud(); // retry with found ID
      } else {
        setSyncStatus('No cloud data found. Push first to create it.', true);
        return;
      }
    } catch (e) {
      setSyncStatus('Error: ' + e.message, true);
      return;
    }
  }

  setSyncStatus('Pulling...', false);
  try {
    const res = await fetch('https://api.github.com/gists/' + gistId, {
      headers: { 'Authorization': 'token ' + token }
    });
    if (!res.ok) throw new Error('Pull failed: ' + res.status);
    const data = await res.json();
    const content = data.files[GIST_FILENAME].content;
    const cloudState = JSON.parse(content);
    // Merge cloud state into local
    state = cloudState;
    if (!state.packingList) state.packingList = initPackingList();
    if (state.fontSize === undefined) state.fontSize = 0;
    if (state.budget === undefined) state.budget = 15000;
    saveState();
    applyDarkMode();
    applyFontSize();
    setSyncStatus('Pulled! ' + new Date().toLocaleTimeString(), false);
    switchTab(state.activeTab || 'today');
  } catch (e) {
    setSyncStatus('Error: ' + e.message, true);
  }
}

async function quickCloudPush() {
  const token = getSyncToken();
  if (!token) {
    alert('Set up your GitHub token in Settings ‚Üí Cloud Sync first.');
    switchTab('settings');
    return;
  }
  const icon = document.getElementById('cloudSyncIcon');
  icon.textContent = '‚è≥';
  try {
    const body = JSON.stringify(state, null, 2);
    const gistId = getSyncGistId();
    if (gistId) {
      const res = await fetch('https://api.github.com/gists/' + gistId, {
        method: 'PATCH',
        headers: { 'Authorization': 'token ' + token, 'Content-Type': 'application/json' },
        body: JSON.stringify({ files: { [GIST_FILENAME]: { content: body } } })
      });
      if (!res.ok) throw new Error(res.status);
    } else {
      const res = await fetch('https://api.github.com/gists', {
        method: 'POST',
        headers: { 'Authorization': 'token ' + token, 'Content-Type': 'application/json' },
        body: JSON.stringify({ description: 'Alps to Tuscany ‚Äî Trip Hub Data', public: false, files: { [GIST_FILENAME]: { content: body } } })
      });
      if (!res.ok) throw new Error(res.status);
      const data = await res.json();
      localStorage.setItem(SYNC_GIST_KEY, data.id);
    }
    icon.textContent = '‚úÖ';
    setTimeout(() => { icon.textContent = '‚òÅÔ∏è'; }, 2000);
  } catch (e) {
    icon.textContent = '‚ùå';
    setTimeout(() => { icon.textContent = '‚òÅÔ∏è'; }, 2000);
  }
}

// ============================================================
// INITIALIZATION
// ============================================================
function init() {
  loadState();
  applyDarkMode();
  applyFontSize();
  switchTab(state.activeTab || 'today');
}

// Start the app
init();
</script>
</body>
</html>
